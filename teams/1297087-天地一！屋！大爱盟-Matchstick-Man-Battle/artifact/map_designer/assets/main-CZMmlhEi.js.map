{"version":3,"file":"main-CZMmlhEi.js","sources":["../../src/core/commands.ts","../../src/main.ts"],"sourcesContent":["/**\r\n * 撤销/重做系统 - 命令模式实现\r\n */\r\n\r\n// 使用any类型避免循环依赖，在main.ts中会有正确的类型\r\ntype MapObject = any;\r\ntype Body = any;\r\n\r\n// 命令接口\r\nexport interface Command {\r\n  execute(): void;\r\n  undo(): void;\r\n  redo(): void;\r\n}\r\n\r\n// 添加对象命令\r\nexport class AddObjectCommand implements Command {\r\n  constructor(\r\n    private objects: MapObject[],\r\n    private object: MapObject,\r\n    private onUpdate: () => void\r\n  ) {}\r\n\r\n  execute(): void {\r\n    this.objects.push(this.object);\r\n    this.onUpdate();\r\n  }\r\n\r\n  undo(): void {\r\n    const index = this.objects.indexOf(this.object);\r\n    if (index > -1) {\r\n      this.objects.splice(index, 1);\r\n    }\r\n    this.onUpdate();\r\n  }\r\n\r\n  redo(): void {\r\n    this.execute();\r\n  }\r\n}\r\n\r\n// 删除对象命令\r\nexport class DeleteObjectCommand implements Command {\r\n  private index: number = -1;\r\n\r\n  constructor(\r\n    private objects: MapObject[],\r\n    private object: MapObject,\r\n    private onUpdate: () => void\r\n  ) {\r\n    this.index = objects.indexOf(object);\r\n  }\r\n\r\n  execute(): void {\r\n    if (this.index > -1) {\r\n      this.objects.splice(this.index, 1);\r\n    }\r\n    this.onUpdate();\r\n  }\r\n\r\n  undo(): void {\r\n    if (this.index > -1) {\r\n      this.objects.splice(this.index, 0, this.object);\r\n    }\r\n    this.onUpdate();\r\n  }\r\n\r\n  redo(): void {\r\n    this.execute();\r\n  }\r\n}\r\n\r\n// 移动对象命令\r\nexport class MoveObjectCommand implements Command {\r\n  private oldX: number;\r\n  private oldY: number;\r\n  private newX: number;\r\n  private newY: number;\r\n\r\n  constructor(\r\n    private body: Body,\r\n    oldX: number,\r\n    oldY: number,\r\n    newX: number,\r\n    newY: number,\r\n    private onUpdate: () => void\r\n  ) {\r\n    this.oldX = oldX;\r\n    this.oldY = oldY;\r\n    this.newX = newX;\r\n    this.newY = newY;\r\n  }\r\n\r\n  execute(): void {\r\n    this.body.position.x = this.newX;\r\n    this.body.position.y = this.newY;\r\n    this.onUpdate();\r\n  }\r\n\r\n  undo(): void {\r\n    this.body.position.x = this.oldX;\r\n    this.body.position.y = this.oldY;\r\n    this.onUpdate();\r\n  }\r\n\r\n  redo(): void {\r\n    this.execute();\r\n  }\r\n}\r\n\r\n// 修改属性命令\r\nexport class ModifyPropertyCommand implements Command {\r\n  private oldValue: any;\r\n  private newValue: any;\r\n\r\n  constructor(\r\n    private object: any,\r\n    private property: string,\r\n    oldValue: any,\r\n    newValue: any,\r\n    private onUpdate: () => void\r\n  ) {\r\n    this.oldValue = oldValue;\r\n    this.newValue = newValue;\r\n  }\r\n\r\n  execute(): void {\r\n    this.object[this.property] = this.newValue;\r\n    this.onUpdate();\r\n  }\r\n\r\n  undo(): void {\r\n    this.object[this.property] = this.oldValue;\r\n    this.onUpdate();\r\n  }\r\n\r\n  redo(): void {\r\n    this.execute();\r\n  }\r\n}\r\n\r\n// 批量命令（用于组合多个操作）\r\nexport class BatchCommand implements Command {\r\n  constructor(\r\n    private commands: Command[]\r\n  ) {}\r\n\r\n  execute(): void {\r\n    this.commands.forEach(cmd => cmd.execute());\r\n  }\r\n\r\n  undo(): void {\r\n    // 反向执行撤销\r\n    for (let i = this.commands.length - 1; i >= 0; i--) {\r\n      this.commands[i].undo();\r\n    }\r\n  }\r\n\r\n  redo(): void {\r\n    this.execute();\r\n  }\r\n}\r\n\r\n// 历史管理器\r\nexport class CommandHistory {\r\n  private history: Command[] = [];\r\n  private currentIndex: number = -1;\r\n  private maxHistorySize: number = 50;\r\n\r\n  canUndo(): boolean {\r\n    return this.currentIndex >= 0;\r\n  }\r\n\r\n  canRedo(): boolean {\r\n    return this.currentIndex < this.history.length - 1;\r\n  }\r\n\r\n  execute(command: Command): void {\r\n    command.execute();\r\n    \r\n    // 清除当前位置之后的历史\r\n    this.history.splice(this.currentIndex + 1);\r\n    \r\n    // 添加新命令\r\n    this.history.push(command);\r\n    this.currentIndex++;\r\n    \r\n    // 限制历史大小\r\n    if (this.history.length > this.maxHistorySize) {\r\n      this.history.shift();\r\n      this.currentIndex--;\r\n    }\r\n  }\r\n\r\n  undo(): void {\r\n    if (this.canUndo()) {\r\n      this.history[this.currentIndex].undo();\r\n      this.currentIndex--;\r\n    }\r\n  }\r\n\r\n  redo(): void {\r\n    if (this.canRedo()) {\r\n      this.currentIndex++;\r\n      this.history[this.currentIndex].redo();\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.history = [];\r\n    this.currentIndex = -1;\r\n  }\r\n\r\n  getHistorySize(): number {\r\n    return this.history.length;\r\n  }\r\n\r\n  getCurrentIndex(): number {\r\n    return this.currentIndex;\r\n  }\r\n}\r\n","/**\r\n * Box2D 地图设计器 - 完整实现\r\n * 这是一个简化但功能完整的单文件实现\r\n */\r\n\r\nimport './app.css';\r\nimport { \r\n  CommandHistory, \r\n  AddObjectCommand, \r\n  DeleteObjectCommand, \r\n  MoveObjectCommand,\r\n  ModifyPropertyCommand \r\n} from '@core/commands';\r\n\r\n// ==================== 类型定义 ====================\r\n\r\ntype BodyType = 'static' | 'dynamic' | 'kinematic';\r\ntype ShapeType = 'box' | 'circle' | 'polygon';\r\ntype JointType = 'revolute'; // 'distance' 已屏蔽\r\ntype Tool = 'select' | 'rect' | 'circle' | 'polygon' | 'revoluteJoint' | 'delete'; // 移除 'distanceJoint'\r\n\r\ninterface Vector2 {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface Body {\r\n  id: string;\r\n  type: 'body';\r\n  shapeType: ShapeType;\r\n  position: Vector2;\r\n  angle: number;\r\n  width?: number;\r\n  height?: number;\r\n  radius?: number;\r\n  vertices?: Vector2[];\r\n  bodyType: BodyType;\r\n  density: number;\r\n  friction: number;\r\n  restitution: number;\r\n  linearDamping: number;\r\n  angularDamping: number;\r\n  gravityScale: number;\r\n  fixedRotation: boolean;\r\n}\r\n\r\ninterface Joint {\r\n  id: string;\r\n  type: 'joint';\r\n  jointType: JointType;\r\n  bodyAId: string;\r\n  bodyBId: string;\r\n  anchorALocal: Vector2;  // Body A 的局部坐标\r\n  anchorBLocal: Vector2;  // Body B 的局部坐标\r\n  length?: number;\r\n  frequencyHz?: number;\r\n  dampingRatio?: number;\r\n  enableLimit?: boolean;\r\n  lowerAngle?: number;\r\n  upperAngle?: number;\r\n  enableMotor?: boolean;\r\n  motorSpeed?: number;\r\n  maxMotorTorque?: number;\r\n  collideConnected?: boolean;\r\n}\r\n\r\ntype MapObject = Body | Joint;\r\n\r\n// ==================== 常量 ====================\r\n\r\n// PPM: Pixels Per Meter - 每米多少像素（可配置）\r\nlet PPM = 20; // 默认 20 像素 = 1 米\r\n\r\n// 视图原点偏移（Box2D 坐标，单位：米）\r\nlet ORIGIN_OFFSET_X = 0;\r\nlet ORIGIN_OFFSET_Y = 0;\r\n\r\nconst GRID_SIZE = 1; // 网格大小 1 米\r\nconst SELECTION_COLOR = '#00ff00';\r\nconst BODY_COLORS = {\r\n  static: '#95a5a6',\r\n  dynamic: '#3498db',\r\n  kinematic: '#9b59b6'\r\n};\r\n\r\n// ==================== 工具函数 ====================\r\n\r\nfunction generateId(prefix: string): string {\r\n  return `${prefix}${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n// Box2D 坐标 <-> Canvas 像素坐标转换\r\n// Box2D: Y向上，原点在Canvas中心底部（可偏移），单位：米\r\n// Canvas: Y向下，原点在左上角，单位：像素\r\n\r\nfunction box2DToCanvas(box2dX: number, box2dY: number, canvasWidth: number, canvasHeight: number): Vector2 {\r\n  // 应用原点偏移\r\n  const offsetX = box2dX - ORIGIN_OFFSET_X;\r\n  const offsetY = box2dY - ORIGIN_OFFSET_Y;\r\n  \r\n  // Box2D 坐标转 Canvas 坐标（Y 向上统一，不翻转）\r\n  return {\r\n    x: canvasWidth / 2 + offsetX * PPM,        // X: 中心偏移\r\n    y: canvasHeight / 2 - offsetY * PPM        // Y: 中心偏移（Canvas 向下为正，所以用减法）\r\n  };\r\n}\r\n\r\nfunction canvasToBox2D(canvasX: number, canvasY: number, canvasWidth: number, canvasHeight: number): Vector2 {\r\n  // Canvas 坐标转 Box2D 坐标（Y 向上统一，不翻转）\r\n  const box2dX = (canvasX - canvasWidth / 2) / PPM;\r\n  const box2dY = (canvasHeight / 2 - canvasY) / PPM;  // Canvas 向下为正，所以用减法\r\n  \r\n  // 应用原点偏移\r\n  return {\r\n    x: box2dX + ORIGIN_OFFSET_X,\r\n    y: box2dY + ORIGIN_OFFSET_Y\r\n  };\r\n}\r\n\r\nfunction box2DToCanvasScale(box2dValue: number): number {\r\n  // Box2D 标量（长度）转 Canvas 像素\r\n  return box2dValue * PPM;\r\n}\r\n\r\n// function canvasToBox2DScale(pixelValue: number): number {\r\n//   // Canvas 像素转 Box2D 标量（长度）\r\n//   return pixelValue / PPM;\r\n// }\r\n\r\nfunction distance(x1: number, y1: number, x2: number, y2: number): number {\r\n  const dx = x2 - x1;\r\n  const dy = y2 - y1;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nfunction worldToLocal(worldX: number, worldY: number, bodyX: number, bodyY: number, bodyAngle: number): Vector2 {\r\n  const dx = worldX - bodyX;\r\n  const dy = worldY - bodyY;\r\n  const cos = Math.cos(-bodyAngle);\r\n  const sin = Math.sin(-bodyAngle);\r\n  return {\r\n    x: dx * cos - dy * sin,\r\n    y: dx * sin + dy * cos\r\n  };\r\n}\r\n\r\nfunction localToWorld(localX: number, localY: number, bodyX: number, bodyY: number, bodyAngle: number): Vector2 {\r\n  const cos = Math.cos(bodyAngle);\r\n  const sin = Math.sin(bodyAngle);\r\n  return {\r\n    x: bodyX + localX * cos - localY * sin,\r\n    y: bodyY + localX * sin + localY * cos\r\n  };\r\n}\r\n\r\nfunction pointInRotatedRect(px: number, py: number, rectX: number, rectY: number, width: number, height: number, angle: number): boolean {\r\n  const local = worldToLocal(px, py, rectX, rectY, angle);\r\n  const halfW = width / 2;\r\n  const halfH = height / 2;\r\n  return local.x >= -halfW && local.x <= halfW && local.y >= -halfH && local.y <= halfH;\r\n}\r\n\r\nfunction pointInCircle(px: number, py: number, cx: number, cy: number, radius: number): boolean {\r\n  return distance(px, py, cx, cy) <= radius;\r\n}\r\n\r\nfunction pointInPolygon(px: number, py: number, vertices: Vector2[], centerX: number, centerY: number, angle: number): boolean {\r\n  // 将点转换到多边形的本地坐标系\r\n  const local = worldToLocal(px, py, centerX, centerY, angle);\r\n  \r\n  // 使用射线法（Ray Casting）判断点是否在多边形内\r\n  let inside = false;\r\n  for (let i = 0, j = vertices.length - 1; i < vertices.length; j = i++) {\r\n    const xi = vertices[i].x;\r\n    const yi = vertices[i].y;\r\n    const xj = vertices[j].x;\r\n    const yj = vertices[j].y;\r\n    \r\n    const intersect = ((yi > local.y) !== (yj > local.y)) &&\r\n      (local.x < (xj - xi) * (local.y - yi) / (yj - yi) + xi);\r\n    if (intersect) inside = !inside;\r\n  }\r\n  return inside;\r\n}\r\n\r\nfunction downloadFile(content: string, filename: string): void {\r\n  const blob = new Blob([content], { type: 'application/json' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n// ==================== 主应用类 ====================\r\n\r\nclass MapDesigner {\r\n  private canvas: HTMLCanvasElement;\r\n  private ctx: CanvasRenderingContext2D;\r\n  private objects: MapObject[] = [];\r\n  private selectedObject: MapObject | null = null;\r\n  private currentTool: Tool = 'select';\r\n  \r\n  private drawingObject: Body | null = null;\r\n  private polygonVertices: Vector2[] = [];\r\n  private jointBodyA: Body | null = null;\r\n  private jointAnchorA: Vector2 | null = null;\r\n  \r\n  private isDragging = false;\r\n  private dragStartPos: Vector2 | null = null;\r\n  private mousePos: Vector2 = { x: 0, y: 0 }; // 当前鼠标位置\r\n  \r\n  // 撤销/重做系统\r\n  private commandHistory: CommandHistory;\r\n  private moveStartPos: Vector2 | null = null; // 用于记录移动开始位置\r\n  \r\n  // 关节锚点拖动\r\n  private draggingAnchor: { joint: Joint; isAnchorA: boolean } | null = null;\r\n  private anchorStartPos: Vector2 | null = null;\r\n  \r\n  // 画布平移（中键拖动）\r\n  private isPanning = false;\r\n  private panStartOriginX = 0;\r\n  private panStartOriginY = 0;\r\n  private panStartMouseX = 0;\r\n  private panStartMouseY = 0;\r\n  \r\n  // 顶点编辑模式\r\n  private isEditingVertices = false;\r\n  private editingBody: Body | null = null;\r\n  private draggedVertexIndex: number = -1;\r\n  private vertexDragStart: Vector2 | null = null;\r\n  \r\n  // 物理预览模式\r\n  private isPreviewMode = false;\r\n  private box2dWorld: any = null;\r\n  private box2dBodies: Map<string, any> = new Map();\r\n  private box2dJoints: Map<string, any> = new Map();\r\n  private previewAnimationId: number | null = null;\r\n  private previewPaused = false;\r\n  private previewOriginalState: Array<{id: string, position: Vector2, angle: number}> = [];\r\n  \r\n  // 预览模式的坐标系快照（用于 Box2D 同步）\r\n  private previewPPM = 20;\r\n  private previewOriginOffsetX = 0;\r\n  private previewOriginOffsetY = 0;\r\n\r\n  constructor(canvasId: string) {\r\n    this.canvas = document.getElementById(canvasId) as HTMLCanvasElement;\r\n    this.ctx = this.canvas.getContext('2d')!;\r\n    this.commandHistory = new CommandHistory();\r\n    \r\n  // 初始视图：将 Box2D 原点 (0,0) 放在 Canvas 的水平中心最下方\r\n  // 计算：box2DToCanvas(0,0).y = canvasHeight => ORIGIN_OFFSET_Y = (canvasHeight/2)/PPM\r\n  ORIGIN_OFFSET_X = 0;\r\n  ORIGIN_OFFSET_Y = (this.canvas.height / 2) / PPM;\r\n\r\n    this.setupEventListeners();\r\n    this.updateUndoRedoButtons();\r\n    this.render();\r\n    // 同步视图控件显示为当前坐标系值\r\n    const ppmSlider = document.getElementById('ppm-slider') as HTMLInputElement | null;\r\n    const ppmValue = document.getElementById('ppm-value') as HTMLSpanElement | null;\r\n    const originXSlider = document.getElementById('origin-x-slider') as HTMLInputElement | null;\r\n    const originXValue = document.getElementById('origin-x-value') as HTMLSpanElement | null;\r\n    const originYSlider = document.getElementById('origin-y-slider') as HTMLInputElement | null;\r\n    const originYValue = document.getElementById('origin-y-value') as HTMLSpanElement | null;\r\n    if (ppmSlider) ppmSlider.value = PPM.toString();\r\n    if (ppmValue) ppmValue.textContent = PPM.toString();\r\n    if (originXSlider) originXSlider.value = ORIGIN_OFFSET_X.toString();\r\n    if (originXValue) originXValue.textContent = ORIGIN_OFFSET_X.toFixed(2);\r\n    if (originYSlider) originYSlider.value = ORIGIN_OFFSET_Y.toFixed(2);\r\n    if (originYValue) originYValue.textContent = ORIGIN_OFFSET_Y.toFixed(2);\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    // 工具栏按钮\r\n    document.querySelectorAll('.tool-btn').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        const tool = (e.currentTarget as HTMLElement).dataset.tool as Tool;\r\n        this.setTool(tool);\r\n      });\r\n    });\r\n\r\n    // 画布事件\r\n    this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));\r\n    this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this));\r\n    this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n    this.canvas.addEventListener('dblclick', this.onDoubleClick.bind(this));\r\n    \r\n    // 画布滚轮缩放\r\n    this.canvas.addEventListener('wheel', this.onMouseWheel.bind(this), { passive: false });\r\n    \r\n    // 阻止右键菜单，以便使用中键\r\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\r\n\r\n    // 文件操作\r\n    document.getElementById('btn-new')?.addEventListener('click', () => this.newMap());\r\n    document.getElementById('btn-save')?.addEventListener('click', () => this.saveMap());\r\n    document.getElementById('btn-load')?.addEventListener('click', () => this.loadMap());\r\n    document.getElementById('btn-export')?.addEventListener('click', () => this.exportBox2D());\r\n    \r\n    // 属性面板收起/展开\r\n    document.getElementById('btn-toggle-panel')?.addEventListener('click', () => this.togglePanel());\r\n    \r\n    // 物理预览\r\n    document.getElementById('btn-preview')?.addEventListener('click', () => this.togglePreview());\r\n    document.getElementById('btn-preview-play')?.addEventListener('click', () => this.resumePreview());\r\n    document.getElementById('btn-preview-pause')?.addEventListener('click', () => this.pausePreview());\r\n    document.getElementById('btn-preview-reset')?.addEventListener('click', () => this.resetPreview());\r\n    document.getElementById('btn-preview-exit')?.addEventListener('click', () => this.exitPreview());\r\n    \r\n    // 撤销/重做按钮\r\n    document.getElementById('btn-undo')?.addEventListener('click', () => this.undo());\r\n    document.getElementById('btn-redo')?.addEventListener('click', () => this.redo());\r\n    \r\n    const fileInput = document.getElementById('file-input') as HTMLInputElement;\r\n    fileInput?.addEventListener('change', (e) => {\r\n      const file = (e.target as HTMLInputElement).files?.[0];\r\n      if (file) this.loadFromFile(file);\r\n    });\r\n\r\n    // 键盘快捷键\r\n    document.addEventListener('keydown', (e) => {\r\n      // 预览模式下只允许 ESC 键退出\r\n      if (this.isPreviewMode) {\r\n        if (e.key === 'Escape') {\r\n          e.preventDefault();\r\n          this.exitPreview();\r\n        }\r\n        return; // 其他按键在预览模式下无效\r\n      }\r\n      \r\n      // 普通模式下的快捷键\r\n      if (e.key === 'Delete' && this.selectedObject) {\r\n        this.deleteSelected();\r\n      } else if (e.ctrlKey && e.key === 'z') {\r\n        e.preventDefault();\r\n        this.undo();\r\n      } else if (e.ctrlKey && e.key === 'y') {\r\n        e.preventDefault();\r\n        this.redo();\r\n      } else if (e.key === ' ') {\r\n        e.preventDefault();\r\n        this.togglePreview();\r\n      }\r\n    });\r\n\r\n    // 视图设置控件\r\n    this.setupViewControls();\r\n  }\r\n\r\n  private setupViewControls(): void {\r\n    const canvasWidthSlider = document.getElementById('canvas-width-slider') as HTMLInputElement;\r\n    const canvasWidthValue = document.getElementById('canvas-width-value') as HTMLSpanElement;\r\n    const canvasHeightSlider = document.getElementById('canvas-height-slider') as HTMLInputElement;\r\n    const canvasHeightValue = document.getElementById('canvas-height-value') as HTMLSpanElement;\r\n    const ppmSlider = document.getElementById('ppm-slider') as HTMLInputElement;\r\n    const ppmValue = document.getElementById('ppm-value') as HTMLSpanElement;\r\n    const originXSlider = document.getElementById('origin-x-slider') as HTMLInputElement;\r\n    const originXValue = document.getElementById('origin-x-value') as HTMLSpanElement;\r\n    const originYSlider = document.getElementById('origin-y-slider') as HTMLInputElement;\r\n    const originYValue = document.getElementById('origin-y-value') as HTMLSpanElement;\r\n    const resetBtn = document.getElementById('btn-reset-view') as HTMLButtonElement;\r\n\r\n    // 画布宽度调整\r\n    canvasWidthSlider?.addEventListener('input', (e) => {\r\n      const value = parseInt((e.target as HTMLInputElement).value);\r\n      this.canvas.width = value;\r\n      if (canvasWidthValue) canvasWidthValue.textContent = value.toString();\r\n      this.render();\r\n      this.updateStatus('画布宽度已调整为 ' + value + 'px');\r\n    });\r\n\r\n    // 画布高度调整\r\n    canvasHeightSlider?.addEventListener('input', (e) => {\r\n      const value = parseInt((e.target as HTMLInputElement).value);\r\n      this.canvas.height = value;\r\n      if (canvasHeightValue) canvasHeightValue.textContent = value.toString();\r\n      this.render();\r\n      this.updateStatus('画布高度已调整为 ' + value + 'px');\r\n    });\r\n\r\n    // PPM 缩放控制\r\n    ppmSlider?.addEventListener('input', (e) => {\r\n      const value = parseInt((e.target as HTMLInputElement).value);\r\n      PPM = value;\r\n      if (ppmValue) ppmValue.textContent = value.toString();\r\n      this.render();\r\n    });\r\n\r\n    // 原点 X 偏移\r\n    originXSlider?.addEventListener('input', (e) => {\r\n      const value = parseFloat((e.target as HTMLInputElement).value);\r\n      ORIGIN_OFFSET_X = value;\r\n      if (originXValue) originXValue.textContent = value.toFixed(2);\r\n      this.render();\r\n    });\r\n\r\n    // 原点 Y 偏移\r\n    originYSlider?.addEventListener('input', (e) => {\r\n      const value = parseFloat((e.target as HTMLInputElement).value);\r\n      ORIGIN_OFFSET_Y = value;\r\n      if (originYValue) originYValue.textContent = value.toFixed(2);\r\n      this.render();\r\n    });\r\n\r\n    // 重置视图\r\n    resetBtn?.addEventListener('click', () => {\r\n      // 重置画布大小\r\n      this.canvas.width = 1000;\r\n      this.canvas.height = 700;\r\n      if (canvasWidthSlider) canvasWidthSlider.value = '1000';\r\n      if (canvasWidthValue) canvasWidthValue.textContent = '1000';\r\n      if (canvasHeightSlider) canvasHeightSlider.value = '700';\r\n      if (canvasHeightValue) canvasHeightValue.textContent = '700';\r\n      \r\n  // 重置缩放和原点（将 Box2D 原点放到 Canvas 水平中心最下方）\r\n  PPM = 20;\r\n  ORIGIN_OFFSET_X = 0;\r\n  ORIGIN_OFFSET_Y = (this.canvas.height / 2) / PPM;\r\n      \r\n  if (ppmSlider) ppmSlider.value = '20';\r\n  if (ppmValue) ppmValue.textContent = '20';\r\n  if (originXSlider) originXSlider.value = '0';\r\n  if (originXValue) originXValue.textContent = '0.00';\r\n  if (originYSlider) originYSlider.value = ORIGIN_OFFSET_Y.toFixed(2);\r\n  if (originYValue) originYValue.textContent = ORIGIN_OFFSET_Y.toFixed(2);\r\n      \r\n      this.render();\r\n      this.updateStatus('视图已重置');\r\n    });\r\n  }\r\n\r\n  private togglePanel(): void {\r\n    const panel = document.getElementById('property-panel');\r\n    if (panel) {\r\n      panel.classList.toggle('collapsed');\r\n      const isCollapsed = panel.classList.contains('collapsed');\r\n      this.updateStatus(isCollapsed ? '属性面板已收起' : '属性面板已展开');\r\n    }\r\n  }\r\n\r\n  private setTool(tool: Tool): void {\r\n    this.currentTool = tool;\r\n    \r\n    // 重置状态\r\n    this.drawingObject = null;\r\n    this.polygonVertices = [];\r\n    this.jointBodyA = null;\r\n    this.jointAnchorA = null;\r\n    \r\n    // 更新UI\r\n    document.querySelectorAll('.tool-btn').forEach(btn => {\r\n      btn.classList.remove('active');\r\n    });\r\n    document.querySelector(`[data-tool=\"${tool}\"]`)?.classList.add('active');\r\n    \r\n    this.updateStatus(`工具: ${tool}`);\r\n    this.render();\r\n  }\r\n\r\n  private getMousePos(e: MouseEvent): Vector2 {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    // 考虑Canvas的缩放比例\r\n    const scaleX = this.canvas.width / rect.width;\r\n    const scaleY = this.canvas.height / rect.height;\r\n    \r\n    const canvasX = (e.clientX - rect.left) * scaleX;\r\n    const canvasY = (e.clientY - rect.top) * scaleY;\r\n    \r\n    // 转换为 Box2D 坐标（Y向上，原点在Canvas中心底部，单位：米）\r\n    return canvasToBox2D(canvasX, canvasY, this.canvas.width, this.canvas.height);\r\n  }\r\n\r\n  private onMouseDown(e: MouseEvent): void {\r\n    // 预览模式下禁用所有鼠标操作（除了中键平移）\r\n    if (this.isPreviewMode && e.button !== 1) {\r\n      return;\r\n    }\r\n    \r\n    // 中键拖动画布\r\n    if (e.button === 1) {\r\n      e.preventDefault();\r\n      this.isPanning = true;\r\n      this.panStartOriginX = ORIGIN_OFFSET_X;\r\n      this.panStartOriginY = ORIGIN_OFFSET_Y;\r\n      this.panStartMouseX = e.clientX;\r\n      this.panStartMouseY = e.clientY;\r\n      this.canvas.style.cursor = 'grabbing';\r\n      return;\r\n    }\r\n    \r\n    // 只有左键才执行工具操作\r\n    if (e.button !== 0) return;\r\n    \r\n    const pos = this.getMousePos(e);\r\n\r\n    switch (this.currentTool) {\r\n      case 'select':\r\n        this.handleSelectMouseDown(pos);\r\n        break;\r\n      case 'rect':\r\n      case 'circle':\r\n        this.handleShapeMouseDown(pos);\r\n        break;\r\n      case 'polygon':\r\n        this.handlePolygonMouseDown(pos);\r\n        break;\r\n      case 'revoluteJoint':\r\n        this.handleJointMouseDown(pos);\r\n        break;\r\n      case 'delete':\r\n        this.handleDeleteMouseDown(pos);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private onMouseMove(e: MouseEvent): void {\r\n    // 画布平移（中键拖动）\r\n    if (this.isPanning) {\r\n      const deltaX = e.clientX - this.panStartMouseX;\r\n      const deltaY = e.clientY - this.panStartMouseY;\r\n      \r\n      // 转换为 Box2D 单位（米）并更新原点偏移\r\n      // 向右拖动 = 画布向右 = 原点向左（减小）\r\n      // 向下拖动 = 画布向下 = 原点向上（增大，因为 Box2D Y 向上）\r\n      ORIGIN_OFFSET_X = this.panStartOriginX - deltaX / PPM;\r\n      ORIGIN_OFFSET_Y = this.panStartOriginY + deltaY / PPM;\r\n      \r\n      // 更新滑块显示\r\n      this.updateViewControlsUI();\r\n      this.render();\r\n      return;\r\n    }\r\n    \r\n    // 预览模式下只更新状态栏坐标\r\n    if (this.isPreviewMode) {\r\n      const pos = this.getMousePos(e);\r\n      this.updateStatus('物理预览模式', `坐标: (${pos.x.toFixed(2)}m, ${pos.y.toFixed(2)}m)`, '按 ESC 或点击退出');\r\n      return;\r\n    }\r\n    \r\n    const pos = this.getMousePos(e);\r\n    this.mousePos = pos; // 保存当前鼠标位置（Box2D坐标）\r\n    \r\n    // 更新状态栏\r\n    if (this.isEditingVertices) {\r\n      this.updateStatus(\r\n        `顶点编辑模式 (拖动顶点修改 | 双击/点击空白处退出)`,\r\n        `坐标: (${pos.x.toFixed(2)}m, ${pos.y.toFixed(2)}m)`\r\n      );\r\n    } else if (this.currentTool === 'polygon' && this.polygonVertices.length > 0) {\r\n      // 多边形创建模式的特殊提示\r\n      const vertexCount = this.polygonVertices.length;\r\n      const maxVertices = 8; // Box2D 物理引擎限制\r\n      let hint = '';\r\n      if (vertexCount < 3) {\r\n        hint = `已有 ${vertexCount} 个顶点，至少需要 3 个`;\r\n      } else if (vertexCount >= maxVertices) {\r\n        hint = `已达到物理引擎限制 (${maxVertices}个)，请点击起始点或双击完成`;\r\n      } else {\r\n        hint = `已有 ${vertexCount} 个顶点（最多${maxVertices}个），双击或点击起始点完成`;\r\n      }\r\n      this.updateStatus(`多边形工具`, `坐标: (${pos.x.toFixed(2)}m, ${pos.y.toFixed(2)}m)`, hint);\r\n    } else {\r\n      this.updateStatus(`工具: ${this.currentTool}`, `坐标: (${pos.x.toFixed(2)}m, ${pos.y.toFixed(2)}m)`);\r\n    }\r\n\r\n    // 顶点拖动\r\n    if (this.draggedVertexIndex >= 0 && this.editingBody?.vertices) {\r\n      const body = this.editingBody;\r\n      \r\n      // 将世界坐标转换为物体局部坐标\r\n      const cos = Math.cos(-body.angle); // 注意这里是逆旋转\r\n      const sin = Math.sin(-body.angle);\r\n      const dx = pos.x - body.position.x;\r\n      const dy = pos.y - body.position.y;\r\n      const localX = dx * cos - dy * sin;\r\n      const localY = dx * sin + dy * cos;\r\n      \r\n      // 更新顶点位置\r\n      body.vertices![this.draggedVertexIndex].x = localX;\r\n      body.vertices![this.draggedVertexIndex].y = localY;\r\n      \r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 拖动锚点\r\n    if (this.draggingAnchor) {\r\n      const { joint, isAnchorA } = this.draggingAnchor;\r\n      const body = this.objects.find(o => o.id === (isAnchorA ? joint.bodyAId : joint.bodyBId)) as Body;\r\n      \r\n      if (body) {\r\n        // 将世界坐标转换为该 body 的局部坐标\r\n        const localPos = worldToLocal(pos.x, pos.y, body.position.x, body.position.y, body.angle);\r\n        \r\n        // 更新锚点位置\r\n        if (isAnchorA) {\r\n          joint.anchorALocal.x = localPos.x;\r\n          joint.anchorALocal.y = localPos.y;\r\n        } else {\r\n          joint.anchorBLocal.x = localPos.x;\r\n          joint.anchorBLocal.y = localPos.y;\r\n        }\r\n        \r\n        // 距离关节已屏蔽，不需要更新长度\r\n      }\r\n      \r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.currentTool === 'select' && this.isDragging && this.selectedObject && this.dragStartPos) {\r\n      const dx = pos.x - this.dragStartPos.x;\r\n      const dy = pos.y - this.dragStartPos.y;\r\n      \r\n      if (this.selectedObject.type === 'body') {\r\n        this.selectedObject.position.x += dx;\r\n        this.selectedObject.position.y += dy;\r\n      }\r\n      \r\n      this.dragStartPos = pos;\r\n      this.render();\r\n    }\r\n\r\n    if (this.drawingObject && (this.currentTool === 'rect' || this.currentTool === 'circle')) {\r\n      this.updateDrawingShape(pos);\r\n      this.render();\r\n    }\r\n    \r\n    // 如果在绘制模式下，实时渲染鼠标位置\r\n    if (this.currentTool !== 'select' || this.polygonVertices.length > 0) {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  private onMouseUp(_e: MouseEvent): void {\r\n    // 结束画布平移\r\n    if (this.isPanning) {\r\n      this.isPanning = false;\r\n      this.canvas.style.cursor = this.isPreviewMode ? 'default' : 'crosshair';\r\n      return;\r\n    }\r\n    \r\n    // 预览模式下禁用所有编辑操作\r\n    if (this.isPreviewMode) {\r\n      return;\r\n    }\r\n    \r\n    if (this.currentTool === 'rect' || this.currentTool === 'circle') {\r\n      if (this.drawingObject) {\r\n        this.finalizeDrawingShape();\r\n      }\r\n    }\r\n\r\n    // 处理锚点拖动结束\r\n    if (this.draggingAnchor && this.anchorStartPos) {\r\n      const { joint, isAnchorA } = this.draggingAnchor;\r\n      const anchor = isAnchorA ? joint.anchorALocal : joint.anchorBLocal;\r\n      const prop = isAnchorA ? 'anchorALocal' : 'anchorBLocal';\r\n      const oldValue = this.anchorStartPos;\r\n      const newValue = { x: anchor.x, y: anchor.y };\r\n      \r\n      // 只有真正移动了才记录命令\r\n      if (oldValue.x !== newValue.x || oldValue.y !== newValue.y) {\r\n        const cmd = new ModifyPropertyCommand(\r\n          joint,\r\n          prop,\r\n          oldValue,\r\n          newValue,\r\n          () => {\r\n            this.render();\r\n            this.updatePropertyPanel();\r\n          }\r\n        );\r\n        this.commandHistory.execute(cmd);\r\n        this.updateUndoRedoButtons();\r\n      }\r\n      \r\n      this.draggingAnchor = null;\r\n      this.anchorStartPos = null;\r\n      this.updatePropertyPanel(); // 更新属性面板显示新位置\r\n    }\r\n    \r\n    // 处理顶点拖动结束\r\n    if (this.draggedVertexIndex >= 0 && this.vertexDragStart && this.editingBody?.vertices) {\r\n      const body = this.editingBody;\r\n      \r\n      // 创建旧顶点数组（拖动前的位置）\r\n      const oldVertices = JSON.parse(JSON.stringify(body.vertices));\r\n      oldVertices[this.draggedVertexIndex].x = this.vertexDragStart.x;\r\n      oldVertices[this.draggedVertexIndex].y = this.vertexDragStart.y;\r\n      \r\n      // 新顶点数组就是当前的 body.vertices（已经在 onMouseMove 中更新了）\r\n      const newVertices = JSON.parse(JSON.stringify(body.vertices));\r\n      \r\n      // 只有真正移动了才记录命令\r\n      const moved = Math.abs(newVertices[this.draggedVertexIndex].x - oldVertices[this.draggedVertexIndex].x) > 0.01 ||\r\n                    Math.abs(newVertices[this.draggedVertexIndex].y - oldVertices[this.draggedVertexIndex].y) > 0.01;\r\n      \r\n      if (moved) {\r\n        const cmd = new ModifyPropertyCommand(\r\n          body,\r\n          'vertices',\r\n          oldVertices,\r\n          newVertices,\r\n          () => {\r\n            this.render();\r\n            this.updatePropertyPanel();\r\n          }\r\n        );\r\n        this.commandHistory.execute(cmd);\r\n        this.updateUndoRedoButtons();\r\n      }\r\n      \r\n      this.draggedVertexIndex = -1;\r\n      this.vertexDragStart = null;\r\n      this.updatePropertyPanel();\r\n    }\r\n\r\n    // 处理移动命令\r\n    if (this.isDragging && this.moveStartPos && this.selectedObject && this.selectedObject.type === 'body') {\r\n      const body = this.selectedObject as Body;\r\n      const oldX = this.moveStartPos.x;\r\n      const oldY = this.moveStartPos.y;\r\n      const newX = body.position.x;\r\n      const newY = body.position.y;\r\n      \r\n      // 只有真正移动了才记录命令\r\n      if (oldX !== newX || oldY !== newY) {\r\n        const cmd = new MoveObjectCommand(\r\n          body,\r\n          oldX,\r\n          oldY,\r\n          newX,\r\n          newY,\r\n          () => this.render()\r\n        );\r\n        this.commandHistory.execute(cmd);\r\n        this.updateUndoRedoButtons();\r\n      }\r\n    }\r\n\r\n    this.isDragging = false;\r\n    this.dragStartPos = null;\r\n    this.moveStartPos = null;\r\n  }\r\n\r\n  private onDoubleClick(e: MouseEvent): void {\r\n    // 预览模式下禁用双击操作\r\n    if (this.isPreviewMode) {\r\n      return;\r\n    }\r\n    \r\n    // 多边形绘制工具：双击完成多边形\r\n    if (this.currentTool === 'polygon' && this.polygonVertices.length >= 3) {\r\n      // 移除最后一个重复添加的点（双击的第二次点击添加的）\r\n      this.polygonVertices.pop();\r\n      this.finalizePolygon();\r\n      return;\r\n    }\r\n    \r\n    // 选择工具：双击多边形进入顶点编辑模式\r\n    if (this.currentTool === 'select') {\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      const scaleX = this.canvas.width / rect.width;\r\n      const scaleY = this.canvas.height / rect.height;\r\n      const canvasX = (e.clientX - rect.left) * scaleX;\r\n      const canvasY = (e.clientY - rect.top) * scaleY;\r\n      const worldPos = canvasToBox2D(canvasX, canvasY, this.canvas.width, this.canvas.height);\r\n      \r\n      // 如果已经在编辑模式，退出编辑模式\r\n      if (this.isEditingVertices) {\r\n        this.exitVertexEditMode();\r\n        return;\r\n      }\r\n      \r\n      // 查找点击的物体\r\n      const obj = this.hitTest(worldPos.x, worldPos.y);\r\n      \r\n      // 如果点击的是多边形，进入顶点编辑模式\r\n      if (obj && obj.type === 'body') {\r\n        const body = obj as Body;\r\n        if (body.shapeType === 'polygon' && body.vertices) {\r\n          this.enterVertexEditMode(body);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private onMouseWheel(e: WheelEvent): void {\r\n    e.preventDefault();\r\n    \r\n    // 获取鼠标在画布上的位置（用于缩放中心）\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    const mouseX = e.clientX - rect.left;\r\n    const mouseY = e.clientY - rect.top;\r\n    \r\n    // 计算鼠标位置的 Box2D 坐标（缩放前）\r\n    const scaleX = this.canvas.width / rect.width;\r\n    const scaleY = this.canvas.height / rect.height;\r\n    const canvasX = mouseX * scaleX;\r\n    const canvasY = mouseY * scaleY;\r\n    const worldPosBefore = canvasToBox2D(canvasX, canvasY, this.canvas.width, this.canvas.height);\r\n    \r\n    // 调整 PPM（缩放）\r\n    const delta = e.deltaY > 0 ? -1 : 1; // 向上滚动放大，向下滚动缩小\r\n    const oldPPM = PPM;\r\n    PPM = Math.max(5, Math.min(50, PPM + delta));\r\n    \r\n    // 如果 PPM 没有改变（达到边界），直接返回\r\n    if (PPM === oldPPM) return;\r\n    \r\n    // 计算鼠标位置的 Box2D 坐标（缩放后）\r\n    const worldPosAfter = canvasToBox2D(canvasX, canvasY, this.canvas.width, this.canvas.height);\r\n    \r\n    // 调整原点偏移，使鼠标位置的世界坐标保持不变\r\n    ORIGIN_OFFSET_X += (worldPosBefore.x - worldPosAfter.x);\r\n    ORIGIN_OFFSET_Y += (worldPosBefore.y - worldPosAfter.y);\r\n    \r\n    // 更新滑块显示\r\n    this.updateViewControlsUI();\r\n    \r\n    // 如果在预览模式，需要重建 Box2D 世界以适应新的缩放\r\n    if (this.isPreviewMode) {\r\n      this.rebuildBox2DWorldWithNewScale();\r\n    } else {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  private updateViewControlsUI(): void {\r\n    // 更新 PPM 显示\r\n    const ppmSlider = document.getElementById('ppm-slider') as HTMLInputElement;\r\n    const ppmValue = document.getElementById('ppm-value') as HTMLSpanElement;\r\n    if (ppmSlider) ppmSlider.value = PPM.toString();\r\n    if (ppmValue) ppmValue.textContent = PPM.toString();\r\n    \r\n    // 更新原点 X 显示\r\n    const originXSlider = document.getElementById('origin-x-slider') as HTMLInputElement;\r\n    const originXValue = document.getElementById('origin-x-value') as HTMLSpanElement;\r\n    if (originXSlider) {\r\n      // 如果超出滑块范围，设置为边界值\r\n      const clampedX = Math.max(-20, Math.min(20, ORIGIN_OFFSET_X));\r\n      originXSlider.value = clampedX.toString();\r\n    }\r\n    if (originXValue) originXValue.textContent = ORIGIN_OFFSET_X.toFixed(2);\r\n    \r\n    // 更新原点 Y 显示\r\n    const originYSlider = document.getElementById('origin-y-slider') as HTMLInputElement;\r\n    const originYValue = document.getElementById('origin-y-value') as HTMLSpanElement;\r\n    if (originYSlider) {\r\n      // 如果超出滑块范围，设置为边界值\r\n      const clampedY = Math.max(-20, Math.min(20, ORIGIN_OFFSET_Y));\r\n      originYSlider.value = clampedY.toString();\r\n    }\r\n    if (originYValue) originYValue.textContent = ORIGIN_OFFSET_Y.toFixed(2);\r\n  }\r\n\r\n  private handleSelectMouseDown(pos: Vector2): void {\r\n    // 顶点编辑模式：尝试选中顶点\r\n    if (this.isEditingVertices && this.editingBody) {\r\n      const vertexIndex = this.hitTestVertex(this.editingBody, pos.x, pos.y);\r\n      if (vertexIndex >= 0) {\r\n        this.draggedVertexIndex = vertexIndex;\r\n        const vertex = this.editingBody.vertices![vertexIndex];\r\n        this.vertexDragStart = { x: vertex.x, y: vertex.y };\r\n        console.log(`开始拖动顶点 ${vertexIndex}`);\r\n        return;\r\n      }\r\n      // 如果没有点击顶点，退出编辑模式\r\n      this.exitVertexEditMode();\r\n    }\r\n    \r\n    // 首先检测是否点击了关节的锚点\r\n    const anchorHit = this.hitTestAnchor(pos.x, pos.y);\r\n    if (anchorHit) {\r\n      // 开始拖动锚点\r\n      this.draggingAnchor = anchorHit;\r\n      this.selectedObject = anchorHit.joint;\r\n      const anchor = anchorHit.isAnchorA ? anchorHit.joint.anchorALocal : anchorHit.joint.anchorBLocal;\r\n      this.anchorStartPos = { x: anchor.x, y: anchor.y };\r\n      this.updatePropertyPanel();\r\n      this.render();\r\n      return;\r\n    }\r\n    \r\n    // 否则检测普通对象\r\n    const obj = this.hitTest(pos.x, pos.y);\r\n    this.selectedObject = obj;\r\n    \r\n    if (obj && obj.type === 'body') {\r\n      this.isDragging = true;\r\n      this.dragStartPos = pos;\r\n      // 记录移动开始位置\r\n      this.moveStartPos = { x: obj.position.x, y: obj.position.y };\r\n    }\r\n    \r\n    this.updatePropertyPanel();\r\n    this.render();\r\n  }\r\n  private handleShapeMouseDown(pos: Vector2): void {\r\n    if (this.currentTool === 'rect') {\r\n      // 创建 1m x 1m 的矩形（Box2D 单位）\r\n      this.drawingObject = this.createBody('box', pos.x, pos.y, 1, 1);\r\n    } else {\r\n      // 创建 0.5m 半径的圆形（Box2D 单位）\r\n      this.drawingObject = this.createBody('circle', pos.x, pos.y, 0.5);\r\n    }\r\n    this.dragStartPos = pos;\r\n  }\r\n\r\n  private handlePolygonMouseDown(pos: Vector2): void {\r\n    // 检查是否点击了起始点（闭合多边形）\r\n    if (this.polygonVertices.length >= 3) {\r\n      const firstVertex = this.polygonVertices[0];\r\n      const distance = Math.sqrt(\r\n        Math.pow(pos.x - firstVertex.x, 2) + \r\n        Math.pow(pos.y - firstVertex.y, 2)\r\n      );\r\n      \r\n      // 如果距离起始点小于 0.5m，则闭合多边形\r\n      if (distance < 0.5) {\r\n        this.finalizePolygon();\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // 检查 Box2D 物理引擎的顶点数限制\r\n    const maxVertices = 8;\r\n    if (this.polygonVertices.length >= maxVertices) {\r\n      this.updateStatus('多边形工具', '', `⚠️ Box2D 物理引擎最多支持 ${maxVertices} 个顶点，请点击起始点或双击完成创建`);\r\n      return;\r\n    }\r\n    \r\n    this.polygonVertices.push({ x: pos.x, y: pos.y });\r\n    this.render();\r\n  }\r\n\r\n  private handleJointMouseDown(pos: Vector2): void {\r\n    const body = this.hitTest(pos.x, pos.y);\r\n    \r\n    if (!body || body.type !== 'body') {\r\n      this.updateStatus('关节工具', '', '请点击一个刚体作为第一个连接点');\r\n      return;\r\n    }\r\n\r\n    if (!this.jointBodyA) {\r\n      // 选择第一个物体\r\n      this.jointBodyA = body as Body;\r\n      this.jointAnchorA = pos;\r\n      this.updateStatus('关节工具', '', `已选择物体 ${this.jointBodyA.id.substring(0, 8)}..., 请选择第二个刚体`);\r\n    } else {\r\n      const bodyB = body as Body;\r\n      \r\n      // 检查是否选择了同一个物体\r\n      if (this.jointBodyA.id === bodyB.id) {\r\n        this.updateStatus('关节工具', '', '❌ 不能连接同一个物体！请选择另一个刚体');\r\n        return;\r\n      }\r\n      \r\n      // 创建关节\r\n      this.createJoint(this.jointBodyA, bodyB, this.jointAnchorA!, pos);\r\n      this.jointBodyA = null;\r\n      this.jointAnchorA = null;\r\n      this.updateStatus('关节工具', '', '✓ 关节已创建！（默认允许碰撞，可在属性面板修改）');\r\n    }\r\n  }\r\n\r\n  private handleDeleteMouseDown(pos: Vector2): void {\r\n    const obj = this.hitTest(pos.x, pos.y);\r\n    if (obj) {\r\n      this.objects = this.objects.filter(o => o.id !== obj.id);\r\n      this.selectedObject = null;\r\n      this.updatePropertyPanel();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  private updateDrawingShape(pos: Vector2): void {\r\n    if (!this.drawingObject || !this.dragStartPos) return;\r\n\r\n    const dx = pos.x - this.dragStartPos.x;\r\n    const dy = pos.y - this.dragStartPos.y;\r\n\r\n    if (this.drawingObject.shapeType === 'box') {\r\n      // Box2D 坐标，最小 0.5m\r\n      this.drawingObject.width = Math.max(0.5, Math.abs(dx));\r\n      this.drawingObject.height = Math.max(0.5, Math.abs(dy));\r\n      // 位置是起始点和结束点的中点\r\n      this.drawingObject.position.x = this.dragStartPos.x + dx / 2;\r\n      this.drawingObject.position.y = this.dragStartPos.y + dy / 2;\r\n    } else if (this.drawingObject.shapeType === 'circle') {\r\n      // Box2D 坐标，最小半径 0.25m\r\n      this.drawingObject.radius = Math.max(0.25, Math.max(Math.abs(dx), Math.abs(dy)) / 2);\r\n    }\r\n  }\r\n\r\n  private finalizeDrawingShape(): void {\r\n    if (this.drawingObject) {\r\n      const newObject = this.drawingObject;\r\n      const cmd = new AddObjectCommand(\r\n        this.objects,\r\n        newObject,\r\n        () => this.render()\r\n      );\r\n      this.commandHistory.execute(cmd);\r\n      \r\n      this.drawingObject = null;\r\n      this.dragStartPos = null;\r\n      this.updateUndoRedoButtons();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  private finalizePolygon(): void {\r\n    if (this.polygonVertices.length >= 3) {\r\n      const centerX = this.polygonVertices.reduce((sum, v) => sum + v.x, 0) / this.polygonVertices.length;\r\n      const centerY = this.polygonVertices.reduce((sum, v) => sum + v.y, 0) / this.polygonVertices.length;\r\n      \r\n      let localVertices = this.polygonVertices.map(v => ({\r\n        x: v.x - centerX,\r\n        y: v.y - centerY\r\n      }));\r\n      \r\n      // 确保顶点是逆时针顺序（Box2D 要求）\r\n      localVertices = this.ensureCounterClockwise(localVertices);\r\n\r\n      const body = this.createBody('polygon', centerX, centerY);\r\n      body.vertices = localVertices;\r\n      \r\n      const cmd = new AddObjectCommand(\r\n        this.objects,\r\n        body,\r\n        () => this.render()\r\n      );\r\n      this.commandHistory.execute(cmd);\r\n      \r\n      this.polygonVertices = [];\r\n      this.updateUndoRedoButtons();\r\n      this.render();\r\n    }\r\n  }\r\n  \r\n  // 确保多边形顶点是逆时针顺序（Box2D 要求）\r\n  private ensureCounterClockwise(vertices: Vector2[]): Vector2[] {\r\n    if (vertices.length < 3) return vertices;\r\n    \r\n    // 计算多边形的有向面积（使用叉积）\r\n    let area = 0;\r\n    for (let i = 0; i < vertices.length; i++) {\r\n      const j = (i + 1) % vertices.length;\r\n      area += vertices[i].x * vertices[j].y;\r\n      area -= vertices[j].x * vertices[i].y;\r\n    }\r\n    \r\n    // 如果面积为负，说明是顺时针，需要反转\r\n    // 注意：在我们的坐标系中（Y向上），正面积表示逆时针\r\n    if (area < 0) {\r\n      console.log('多边形顶点是顺时针，反转为逆时针');\r\n      return vertices.reverse();\r\n    }\r\n    \r\n    return vertices;\r\n  }\r\n\r\n  private createBody(shapeType: ShapeType, x: number, y: number, width?: number, height?: number): Body {\r\n    return {\r\n      id: generateId('body_'),\r\n      type: 'body',\r\n      shapeType,\r\n      position: { x, y },\r\n      angle: 0,\r\n      width,\r\n      height,\r\n      radius: shapeType === 'circle' ? 20 : undefined,\r\n      bodyType: 'dynamic',\r\n      density: 1.0,\r\n      friction: 0.3,\r\n      restitution: 0.5,\r\n      linearDamping: 0,\r\n      angularDamping: 0,\r\n      gravityScale: 1,\r\n      fixedRotation: false\r\n    };\r\n  }\r\n\r\n  private createJoint(bodyA: Body, bodyB: Body, anchorA: Vector2, anchorB: Vector2): void {\r\n    // 将世界坐标转换为局部坐标\r\n    const anchorALocal = worldToLocal(anchorA.x, anchorA.y, bodyA.position.x, bodyA.position.y, bodyA.angle);\r\n    const anchorBLocal = worldToLocal(anchorB.x, anchorB.y, bodyB.position.x, bodyB.position.y, bodyB.angle);\r\n    \r\n    const joint: Joint = {\r\n      id: generateId('joint_'),\r\n      type: 'joint',\r\n      jointType: 'revolute', // 只支持旋转关节\r\n      bodyAId: bodyA.id,\r\n      bodyBId: bodyB.id,\r\n      anchorALocal,\r\n      anchorBLocal\r\n    };\r\n\r\n    // 初始化旋转关节属性\r\n    joint.enableLimit = false;\r\n    joint.lowerAngle = -Math.PI / 2;\r\n    joint.upperAngle = Math.PI / 2;\r\n    joint.enableMotor = false;\r\n    joint.motorSpeed = 0;\r\n    joint.maxMotorTorque = 1000;\r\n    joint.collideConnected = true;  // 默认允许碰撞（更符合现实物理）\r\n\r\n    const cmd = new AddObjectCommand(\r\n      this.objects,\r\n      joint,\r\n      () => this.render()\r\n    );\r\n    this.commandHistory.execute(cmd);\r\n    \r\n    this.updateUndoRedoButtons();\r\n    this.render();\r\n  }\r\n\r\n  private hitTest(x: number, y: number): MapObject | null {\r\n    // 将像素阈值转换为 Box2D 单位（米）\r\n    const hitRadius = 10 / PPM; // 10 像素的点击范围\r\n    \r\n    // 优先检测关节的锚点（更小更精确）\r\n    for (let i = this.objects.length - 1; i >= 0; i--) {\r\n      const obj = this.objects[i];\r\n      \r\n      if (obj.type === 'joint') {\r\n        const joint = obj as Joint;\r\n        const bodyA = this.objects.find(o => o.id === joint.bodyAId) as Body;\r\n        const bodyB = this.objects.find(o => o.id === joint.bodyBId) as Body;\r\n        \r\n        if (bodyA && bodyB) {\r\n          const anchorAWorld = localToWorld(\r\n            joint.anchorALocal.x, joint.anchorALocal.y,\r\n            bodyA.position.x, bodyA.position.y, bodyA.angle\r\n          );\r\n          const anchorBWorld = localToWorld(\r\n            joint.anchorBLocal.x, joint.anchorBLocal.y,\r\n            bodyB.position.x, bodyB.position.y, bodyB.angle\r\n          );\r\n          \r\n          // 检测是否点击了锚点\r\n          if (distance(x, y, anchorAWorld.x, anchorAWorld.y) <= hitRadius ||\r\n              distance(x, y, anchorBWorld.x, anchorBWorld.y) <= hitRadius) {\r\n            return joint;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 然后检测刚体\r\n    for (let i = this.objects.length - 1; i >= 0; i--) {\r\n      const obj = this.objects[i];\r\n      \r\n      if (obj.type === 'body') {\r\n        if (obj.shapeType === 'box' && obj.width && obj.height) {\r\n          if (pointInRotatedRect(x, y, obj.position.x, obj.position.y, obj.width, obj.height, obj.angle)) {\r\n            return obj;\r\n          }\r\n        } else if (obj.shapeType === 'circle' && obj.radius) {\r\n          if (pointInCircle(x, y, obj.position.x, obj.position.y, obj.radius)) {\r\n            return obj;\r\n          }\r\n        } else if (obj.shapeType === 'polygon' && obj.vertices && obj.vertices.length >= 3) {\r\n          if (pointInPolygon(x, y, obj.vertices, obj.position.x, obj.position.y, obj.angle)) {\r\n            return obj;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // 检测点击的是哪个锚点（x, y 为 Box2D 坐标）\r\n  private hitTestAnchor(x: number, y: number): { joint: Joint; isAnchorA: boolean } | null {\r\n    // 将像素阈值转换为 Box2D 单位（米）\r\n    const hitRadius = 10 / PPM; // 10 像素的点击范围\r\n    \r\n    for (let i = this.objects.length - 1; i >= 0; i--) {\r\n      const obj = this.objects[i];\r\n      \r\n      if (obj.type === 'joint') {\r\n        const joint = obj as Joint;\r\n        const bodyA = this.objects.find(o => o.id === joint.bodyAId) as Body;\r\n        const bodyB = this.objects.find(o => o.id === joint.bodyBId) as Body;\r\n        \r\n        if (bodyA && bodyB) {\r\n          const anchorAWorld = localToWorld(\r\n            joint.anchorALocal.x, joint.anchorALocal.y,\r\n            bodyA.position.x, bodyA.position.y, bodyA.angle\r\n          );\r\n          const anchorBWorld = localToWorld(\r\n            joint.anchorBLocal.x, joint.anchorBLocal.y,\r\n            bodyB.position.x, bodyB.position.y, bodyB.angle\r\n          );\r\n          \r\n          // 优先检测锚点 A\r\n          if (distance(x, y, anchorAWorld.x, anchorAWorld.y) <= hitRadius) {\r\n            return { joint, isAnchorA: true };\r\n          }\r\n          // 然后检测锚点 B\r\n          if (distance(x, y, anchorBWorld.x, anchorBWorld.y) <= hitRadius) {\r\n            return { joint, isAnchorA: false };\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // ==================== 顶点编辑模式 ====================\r\n  \r\n  private enterVertexEditMode(body: Body): void {\r\n    this.isEditingVertices = true;\r\n    this.editingBody = body;\r\n    this.selectedObject = body;\r\n    console.log(`进入顶点编辑模式: ${body.id}`);\r\n    this.updateStatus('顶点编辑模式', '拖动顶点修改位置', '双击或点击空白处退出');\r\n    this.render();\r\n  }\r\n  \r\n  private exitVertexEditMode(): void {\r\n    this.isEditingVertices = false;\r\n    this.editingBody = null;\r\n    this.draggedVertexIndex = -1;\r\n    this.vertexDragStart = null;\r\n    console.log('退出顶点编辑模式');\r\n    this.updateStatus('退出顶点编辑模式');\r\n    this.render();\r\n  }\r\n  \r\n  private hitTestVertex(body: Body, worldX: number, worldY: number): number {\r\n    if (!body.vertices) return -1;\r\n    \r\n    const hitRadius = 0.3; // 顶点点击半径（米）\r\n    \r\n    for (let i = 0; i < body.vertices.length; i++) {\r\n      const vertex = body.vertices[i];\r\n      // 将本地顶点坐标转换为世界坐标\r\n      const cos = Math.cos(body.angle);\r\n      const sin = Math.sin(body.angle);\r\n      const worldVx = body.position.x + vertex.x * cos - vertex.y * sin;\r\n      const worldVy = body.position.y + vertex.x * sin + vertex.y * cos;\r\n      \r\n      const dist = Math.sqrt(\r\n        (worldX - worldVx) ** 2 + (worldY - worldVy) ** 2\r\n      );\r\n      \r\n      if (dist <= hitRadius) {\r\n        return i;\r\n      }\r\n    }\r\n    \r\n    return -1;\r\n  }\r\n\r\n  private deleteSelected(): void {\r\n    if (this.selectedObject) {\r\n      const objToDelete = this.selectedObject;\r\n      const cmd = new DeleteObjectCommand(\r\n        this.objects,\r\n        objToDelete,\r\n        () => {\r\n          this.selectedObject = null;\r\n          this.updatePropertyPanel();\r\n          this.render();\r\n        }\r\n      );\r\n      this.commandHistory.execute(cmd);\r\n      \r\n      this.updateUndoRedoButtons();\r\n    }\r\n  }\r\n\r\n  private render(): void {\r\n    const ctx = this.ctx;\r\n    const width = this.canvas.width;\r\n    const height = this.canvas.height;\r\n\r\n    // 清空画布\r\n    ctx.clearRect(0, 0, width, height);\r\n\r\n    // 绘制网格（Box2D 坐标系，每格 GRID_SIZE 米）\r\n    ctx.strokeStyle = '#e0e0e0';\r\n    ctx.lineWidth = 1;\r\n    \r\n    // 计算可视范围的 Box2D 坐标（Y 向上为正）\r\n    const worldMinX = ORIGIN_OFFSET_X - (width / 2) / PPM;\r\n    const worldMaxX = ORIGIN_OFFSET_X + (width / 2) / PPM;\r\n    const worldMinY = ORIGIN_OFFSET_Y - (height / 2) / PPM;  // Y 向上，Canvas 下方对应负值\r\n    const worldMaxY = ORIGIN_OFFSET_Y + (height / 2) / PPM;  // Y 向上，Canvas 上方对应正值\r\n    \r\n    // 绘制垂直网格线\r\n    for (let x = Math.floor(worldMinX / GRID_SIZE) * GRID_SIZE; x <= worldMaxX; x += GRID_SIZE) {\r\n      const canvasPos = box2DToCanvas(x, 0, width, height);\r\n      ctx.beginPath();\r\n      ctx.moveTo(canvasPos.x, 0);\r\n      ctx.lineTo(canvasPos.x, height);\r\n      ctx.stroke();\r\n    }\r\n    \r\n    // 绘制水平网格线\r\n    for (let y = Math.floor(worldMinY / GRID_SIZE) * GRID_SIZE; y <= worldMaxY; y += GRID_SIZE) {\r\n      const canvasPos = box2DToCanvas(0, y, width, height);\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, canvasPos.y);\r\n      ctx.lineTo(width, canvasPos.y);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // 绘制坐标轴标记（Box2D 坐标，米）\r\n    ctx.fillStyle = '#666';\r\n    ctx.font = '10px monospace';\r\n    \r\n    // X 轴标记（每 5米）\r\n    for (let x = Math.ceil(worldMinX); x <= Math.floor(worldMaxX); x++) {\r\n      if (x % 5 === 0) {\r\n        const canvasPos = box2DToCanvas(x, worldMinY, width, height);\r\n        ctx.fillText(`${x}m`, canvasPos.x + 2, height - 5);\r\n      }\r\n    }\r\n    \r\n    // Y 轴标记（每 5米）\r\n    for (let y = Math.ceil(worldMinY); y <= Math.floor(worldMaxY); y++) {\r\n      if (y % 5 === 0) {\r\n        const canvasPos = box2DToCanvas(worldMinX, y, width, height);\r\n        ctx.fillText(`${y}m`, 5, canvasPos.y - 2);\r\n      }\r\n    }\r\n    \r\n    // 绘制原点标记（红色十字）\r\n    const origin = box2DToCanvas(0, 0, width, height);\r\n    ctx.strokeStyle = '#ff0000';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(origin.x - 10, origin.y);\r\n    ctx.lineTo(origin.x + 10, origin.y);\r\n    ctx.moveTo(origin.x, origin.y - 10);\r\n    ctx.lineTo(origin.x, origin.y + 10);\r\n    ctx.stroke();\r\n    ctx.fillStyle = '#ff0000';\r\n    ctx.font = '11px monospace';\r\n    ctx.fillText('(0,0)', origin.x + 12, origin.y - 5);\r\n\r\n    // 绘制对象\r\n    this.objects.forEach(obj => {\r\n      if (obj.type === 'body') {\r\n        this.renderBody(obj);\r\n      } else {\r\n        this.renderJoint(obj);\r\n      }\r\n    });\r\n\r\n    // 绘制正在创建的对象\r\n    if (this.drawingObject) {\r\n      this.renderBody(this.drawingObject);\r\n    }\r\n\r\n    // 绘制多边形顶点（Box2D 坐标）\r\n    if (this.polygonVertices.length > 0) {\r\n      ctx.strokeStyle = '#3498db';\r\n      ctx.fillStyle = '#3498db';\r\n      ctx.lineWidth = 2;\r\n      \r\n      // 绘制已有的边\r\n      ctx.beginPath();\r\n      const firstCanvas = box2DToCanvas(this.polygonVertices[0].x, this.polygonVertices[0].y, width, height);\r\n      ctx.moveTo(firstCanvas.x, firstCanvas.y);\r\n      for (let i = 1; i < this.polygonVertices.length; i++) {\r\n        const canvasPos = box2DToCanvas(this.polygonVertices[i].x, this.polygonVertices[i].y, width, height);\r\n        ctx.lineTo(canvasPos.x, canvasPos.y);\r\n      }\r\n      ctx.stroke();\r\n\r\n      // 绘制所有顶点\r\n      this.polygonVertices.forEach((v, index) => {\r\n        const canvasPos = box2DToCanvas(v.x, v.y, width, height);\r\n        ctx.beginPath();\r\n        \r\n        // 起始点用特殊样式（更大，绿色边框）\r\n        if (index === 0 && this.polygonVertices.length >= 3) {\r\n          ctx.fillStyle = '#3498db';\r\n          ctx.strokeStyle = '#27ae60'; // 绿色边框\r\n          ctx.lineWidth = 3;\r\n          ctx.arc(canvasPos.x, canvasPos.y, 8, 0, Math.PI * 2);\r\n          ctx.fill();\r\n          ctx.stroke();\r\n          \r\n          // 绘制提示文字\r\n          ctx.fillStyle = '#27ae60';\r\n          ctx.font = 'bold 11px monospace';\r\n          ctx.fillText('点击闭合', canvasPos.x + 12, canvasPos.y - 8);\r\n        } else {\r\n          ctx.fillStyle = '#3498db';\r\n          ctx.arc(canvasPos.x, canvasPos.y, 5, 0, Math.PI * 2);\r\n          ctx.fill();\r\n        }\r\n      });\r\n      \r\n      // 从最后一个顶点到鼠标位置画虚线\r\n      if (this.polygonVertices.length > 0) {\r\n        ctx.setLineDash([5, 5]);\r\n        ctx.strokeStyle = '#3498db';\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        const lastVertex = this.polygonVertices[this.polygonVertices.length - 1];\r\n        const lastCanvas = box2DToCanvas(lastVertex.x, lastVertex.y, width, height);\r\n        const mouseCanvas = box2DToCanvas(this.mousePos.x, this.mousePos.y, width, height);\r\n        ctx.moveTo(lastCanvas.x, lastCanvas.y);\r\n        ctx.lineTo(mouseCanvas.x, mouseCanvas.y);\r\n        ctx.stroke();\r\n        ctx.setLineDash([]);\r\n        \r\n        // 如果鼠标靠近起始点，显示闭合预览\r\n        if (this.polygonVertices.length >= 3) {\r\n          const firstVertex = this.polygonVertices[0];\r\n          const distance = Math.sqrt(\r\n            Math.pow(this.mousePos.x - firstVertex.x, 2) + \r\n            Math.pow(this.mousePos.y - firstVertex.y, 2)\r\n          );\r\n          \r\n          if (distance < 0.5) {\r\n            // 绘制闭合边的预览（虚线）\r\n            ctx.setLineDash([5, 5]);\r\n            ctx.strokeStyle = '#27ae60';\r\n            ctx.lineWidth = 2;\r\n            ctx.beginPath();\r\n            ctx.moveTo(lastCanvas.x, lastCanvas.y);\r\n            ctx.lineTo(firstCanvas.x, firstCanvas.y);\r\n            ctx.stroke();\r\n            ctx.setLineDash([]);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // 显示顶点数量提示\r\n      if (this.polygonVertices.length > 0) {\r\n        const maxVertices = 8; // Box2D 物理引擎限制\r\n        const text = this.polygonVertices.length >= maxVertices\r\n          ? `顶点: ${this.polygonVertices.length}/${maxVertices} (已达物理引擎限制，双击或点击起始点完成)`\r\n          : `顶点: ${this.polygonVertices.length}/${maxVertices} (至少3个，双击或点击起始点完成)`;\r\n        ctx.fillStyle = this.polygonVertices.length >= maxVertices ? '#e74c3c' : '#2c3e50';\r\n        ctx.font = 'bold 12px monospace';\r\n        ctx.fillText(text, 10, height - 10);\r\n      }\r\n    }\r\n    \r\n    // 绘制鼠标十字线（仅在创建模式下）\r\n    if (this.currentTool !== 'select' && !this.isDragging) {\r\n      const mouseCanvas = box2DToCanvas(this.mousePos.x, this.mousePos.y, width, height);\r\n      \r\n      ctx.strokeStyle = '#999';\r\n      ctx.lineWidth = 1;\r\n      ctx.setLineDash([3, 3]);\r\n      \r\n      // 垂直线\r\n      ctx.beginPath();\r\n      ctx.moveTo(mouseCanvas.x, 0);\r\n      ctx.lineTo(mouseCanvas.x, height);\r\n      ctx.stroke();\r\n      \r\n      // 水平线\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, mouseCanvas.y);\r\n      ctx.lineTo(width, mouseCanvas.y);\r\n      ctx.stroke();\r\n      \r\n      ctx.setLineDash([]);\r\n      \r\n      // 鼠标位置标记\r\n      ctx.fillStyle = '#e74c3c';\r\n      ctx.beginPath();\r\n      ctx.arc(mouseCanvas.x, mouseCanvas.y, 4, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      \r\n      // 显示坐标\r\n      ctx.fillStyle = '#333';\r\n      ctx.font = '11px monospace';\r\n      ctx.fillText(`(${this.mousePos.x.toFixed(2)}m, ${this.mousePos.y.toFixed(2)}m)`, \r\n                   mouseCanvas.x + 10, mouseCanvas.y - 10);\r\n    }\r\n    \r\n    // 绘制关节工具的视觉反馈\r\n    if (this.currentTool === 'revoluteJoint' && this.jointBodyA && this.jointAnchorA) {\r\n      const width = this.canvas.width;\r\n      const height = this.canvas.height;\r\n      \r\n      // 高亮第一个选中的物体\r\n      ctx.save();\r\n      ctx.strokeStyle = '#f39c12';\r\n      ctx.lineWidth = 3;\r\n      ctx.setLineDash([5, 5]);\r\n      \r\n      const bodyCenter = box2DToCanvas(this.jointBodyA.position.x, this.jointBodyA.position.y, width, height);\r\n      if (this.jointBodyA.shapeType === 'box' && this.jointBodyA.width && this.jointBodyA.height) {\r\n        const w = this.jointBodyA.width * PPM;\r\n        const h = this.jointBodyA.height * PPM;\r\n        ctx.strokeRect(bodyCenter.x - w / 2 - 5, bodyCenter.y - h / 2 - 5, w + 10, h + 10);\r\n      } else if (this.jointBodyA.shapeType === 'circle' && this.jointBodyA.radius) {\r\n        const r = this.jointBodyA.radius * PPM;\r\n        ctx.beginPath();\r\n        ctx.arc(bodyCenter.x, bodyCenter.y, r + 5, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n      }\r\n      \r\n      ctx.setLineDash([]);\r\n      \r\n      // 绘制第一个锚点\r\n      const anchorA = box2DToCanvas(this.jointAnchorA.x, this.jointAnchorA.y, width, height);\r\n      ctx.fillStyle = '#f39c12';\r\n      ctx.beginPath();\r\n      ctx.arc(anchorA.x, anchorA.y, 6, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      \r\n      // 从锚点到鼠标位置画虚线\r\n      const mouseCanvas = box2DToCanvas(this.mousePos.x, this.mousePos.y, width, height);\r\n      ctx.strokeStyle = '#f39c12';\r\n      ctx.lineWidth = 2;\r\n      ctx.setLineDash([5, 5]);\r\n      ctx.beginPath();\r\n      ctx.moveTo(anchorA.x, anchorA.y);\r\n      ctx.lineTo(mouseCanvas.x, mouseCanvas.y);\r\n      ctx.stroke();\r\n      \r\n      ctx.restore();\r\n    }\r\n  }\r\n\r\n  private renderBody(body: Body): void {\r\n    const ctx = this.ctx;\r\n    const width = this.canvas.width;\r\n    const height = this.canvas.height;\r\n    const isSelected = this.selectedObject === body;\r\n\r\n    // Box2D → Canvas 坐标转换\r\n    const canvasPos = box2DToCanvas(body.position.x, body.position.y, width, height);\r\n\r\n    ctx.save();\r\n    ctx.translate(canvasPos.x, canvasPos.y);\r\n    ctx.rotate(-body.angle);  // Box2D 逆时针为正 → Canvas 顺时针为正\r\n\r\n    ctx.fillStyle = BODY_COLORS[body.bodyType];\r\n    ctx.strokeStyle = isSelected ? SELECTION_COLOR : '#2c3e50';\r\n    ctx.lineWidth = isSelected ? 3 : 2;\r\n\r\n    if (body.shapeType === 'box' && body.width && body.height) {\r\n      const w = box2DToCanvasScale(body.width);\r\n      const h = box2DToCanvasScale(body.height);\r\n      ctx.fillRect(-w / 2, -h / 2, w, h);\r\n      ctx.strokeRect(-w / 2, -h / 2, w, h);\r\n      \r\n      // 绘制方向指示线\r\n      ctx.strokeStyle = isSelected ? '#fff' : '#34495e';\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(w / 2, 0);\r\n      ctx.stroke();\r\n    } else if (body.shapeType === 'circle' && body.radius) {\r\n      const r = box2DToCanvasScale(body.radius);\r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, r, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      \r\n      // 绘制半径指示线\r\n      ctx.strokeStyle = isSelected ? '#fff' : '#34495e';\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(r, 0);\r\n      ctx.stroke();\r\n    } else if (body.shapeType === 'polygon' && body.vertices && body.vertices.length > 0) {\r\n      ctx.beginPath();\r\n      const firstVertex = body.vertices[0];\r\n      const firstCanvas = { x: box2DToCanvasScale(firstVertex.x), y: -box2DToCanvasScale(firstVertex.y) };\r\n      ctx.moveTo(firstCanvas.x, firstCanvas.y);\r\n      \r\n      for (let i = 1; i < body.vertices.length; i++) {\r\n        const v = body.vertices[i];\r\n        const vCanvas = { x: box2DToCanvasScale(v.x), y: -box2DToCanvasScale(v.y) };\r\n        ctx.lineTo(vCanvas.x, vCanvas.y);\r\n      }\r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.stroke();\r\n    }\r\n\r\n    // 绘制中心点\r\n    ctx.fillStyle = isSelected ? '#fff' : '#2c3e50';\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, 3, 0, Math.PI * 2);\r\n    ctx.fill();\r\n\r\n    ctx.restore();\r\n    \r\n    // 顶点编辑模式：绘制可拖动的顶点控制点\r\n    if (this.isEditingVertices && this.editingBody === body && body.vertices) {\r\n      for (let i = 0; i < body.vertices.length; i++) {\r\n        const vertex = body.vertices[i];\r\n        \r\n        // 将本地顶点坐标转换为世界坐标\r\n        const cos = Math.cos(body.angle);\r\n        const sin = Math.sin(body.angle);\r\n        const worldX = body.position.x + vertex.x * cos - vertex.y * sin;\r\n        const worldY = body.position.y + vertex.x * sin + vertex.y * cos;\r\n        \r\n        // 转换为画布坐标\r\n        const canvasVertex = box2DToCanvas(worldX, worldY, width, height);\r\n        \r\n        // 绘制顶点控制点\r\n        ctx.save();\r\n        ctx.fillStyle = this.draggedVertexIndex === i ? '#e74c3c' : '#3498db';\r\n        ctx.strokeStyle = '#fff';\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        ctx.arc(canvasVertex.x, canvasVertex.y, 6, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n        \r\n        // 绘制顶点索引\r\n        ctx.fillStyle = '#fff';\r\n        ctx.font = 'bold 10px monospace';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.fillText(i.toString(), canvasVertex.x, canvasVertex.y);\r\n        ctx.restore();\r\n      }\r\n    }\r\n    \r\n    // 绘制 ID 标签（在Canvas坐标系中）\r\n    if (isSelected) {\r\n      ctx.fillStyle = '#333';\r\n      ctx.font = '10px monospace';\r\n      ctx.fillText(body.id.substring(0, 12) + '...', canvasPos.x + 10, canvasPos.y - 10);\r\n    }\r\n  }\r\n\r\n  private renderJoint(joint: Joint): void {\r\n    const ctx = this.ctx;\r\n    const width = this.canvas.width;\r\n    const height = this.canvas.height;\r\n    const isSelected = this.selectedObject === joint;\r\n\r\n    // 找到关联的两个 Body\r\n    const bodyA = this.objects.find(o => o.id === joint.bodyAId) as Body;\r\n    const bodyB = this.objects.find(o => o.id === joint.bodyBId) as Body;\r\n    \r\n    if (!bodyA || !bodyB) return; // Body 不存在则不渲染\r\n    \r\n    // 将局部坐标转换为世界坐标（Box2D）\r\n    const anchorAWorld = localToWorld(\r\n      joint.anchorALocal.x, \r\n      joint.anchorALocal.y, \r\n      bodyA.position.x, \r\n      bodyA.position.y, \r\n      bodyA.angle\r\n    );\r\n    const anchorBWorld = localToWorld(\r\n      joint.anchorBLocal.x, \r\n      joint.anchorBLocal.y, \r\n      bodyB.position.x, \r\n      bodyB.position.y, \r\n      bodyB.angle\r\n    );\r\n    \r\n    // 转换为 Canvas 坐标\r\n    const anchorACanvas = box2DToCanvas(anchorAWorld.x, anchorAWorld.y, width, height);\r\n    const anchorBCanvas = box2DToCanvas(anchorBWorld.x, anchorBWorld.y, width, height);\r\n\r\n    // 绘制连线\r\n    ctx.strokeStyle = isSelected ? SELECTION_COLOR : '#e67e22';\r\n    ctx.lineWidth = isSelected ? 3 : 2;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(anchorACanvas.x, anchorACanvas.y);\r\n    ctx.lineTo(anchorBCanvas.x, anchorBCanvas.y);\r\n    ctx.stroke();\r\n\r\n    // 绘制锚点\r\n    const anchorRadius = isSelected ? 7 : 5;\r\n    ctx.fillStyle = '#e74c3c'; // 旋转关节使用红色\r\n    \r\n    // 检测是否正在拖动某个锚点\r\n    const isDraggingAnchorA = this.draggingAnchor && this.draggingAnchor.joint === joint && this.draggingAnchor.isAnchorA;\r\n    const isDraggingAnchorB = this.draggingAnchor && this.draggingAnchor.joint === joint && !this.draggingAnchor.isAnchorA;\r\n    \r\n    // 锚点 A\r\n    ctx.beginPath();\r\n    ctx.arc(anchorACanvas.x, anchorACanvas.y, isDraggingAnchorA ? 10 : anchorRadius, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    if (isSelected || isDraggingAnchorA) {\r\n      ctx.strokeStyle = isDraggingAnchorA ? '#00ff00' : '#fff';\r\n      ctx.lineWidth = isDraggingAnchorA ? 3 : 2;\r\n      ctx.stroke();\r\n    }\r\n    \r\n    // 锚点 B\r\n    ctx.fillStyle = '#9b59b6'; // 锚点 B 使用紫色区分\r\n    ctx.beginPath();\r\n    ctx.arc(anchorBCanvas.x, anchorBCanvas.y, isDraggingAnchorB ? 10 : anchorRadius, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    if (isSelected || isDraggingAnchorB) {\r\n      ctx.strokeStyle = isDraggingAnchorB ? '#00ff00' : '#fff';\r\n      ctx.lineWidth = isDraggingAnchorB ? 3 : 2;\r\n      ctx.stroke();\r\n    }\r\n    \r\n    // 标签\r\n    if (isSelected) {\r\n      ctx.fillStyle = '#333';\r\n      ctx.font = '10px monospace';\r\n      const midX = (anchorACanvas.x + anchorBCanvas.x) / 2;\r\n      const midY = (anchorACanvas.y + anchorBCanvas.y) / 2;\r\n      ctx.fillText('Revolute Joint', midX + 5, midY - 5);\r\n    }\r\n  }\r\n\r\n  private updatePropertyPanel(): void {\r\n    const panel = document.getElementById('property-content');\r\n    if (!panel) return;\r\n\r\n    if (!this.selectedObject) {\r\n      panel.innerHTML = '<p class=\"placeholder\">请选择一个对象以编辑其属性</p>';\r\n      return;\r\n    }\r\n\r\n    if (this.selectedObject.type === 'body') {\r\n      panel.innerHTML = this.generateBodyProperties(this.selectedObject);\r\n      this.bindBodyPropertyEvents();\r\n    } else {\r\n      panel.innerHTML = this.generateJointProperties(this.selectedObject);\r\n      this.bindJointPropertyEvents();\r\n    }\r\n  }\r\n\r\n  private generateBodyProperties(body: Body): string {\r\n    // 生成形状尺寸编辑部分\r\n    let shapePropertiesHTML = '';\r\n    \r\n    if (body.shapeType === 'box' && body.width !== undefined && body.height !== undefined) {\r\n      shapePropertiesHTML = `\r\n        <div class=\"property-group\">\r\n          <div class=\"property-group-title\">矩形尺寸 (单位：米)</div>\r\n          <div class=\"property-field\">\r\n            <label>宽度 (Width)</label>\r\n            <input type=\"number\" id=\"prop-width\" class=\"body-prop\" value=\"${body.width.toFixed(2)}\" step=\"0.1\" min=\"0.1\">\r\n          </div>\r\n          <div class=\"property-field\">\r\n            <label>高度 (Height)</label>\r\n            <input type=\"number\" id=\"prop-height\" class=\"body-prop\" value=\"${body.height.toFixed(2)}\" step=\"0.1\" min=\"0.1\">\r\n          </div>\r\n        </div>\r\n      `;\r\n    } else if (body.shapeType === 'circle' && body.radius !== undefined) {\r\n      shapePropertiesHTML = `\r\n        <div class=\"property-group\">\r\n          <div class=\"property-group-title\">圆形尺寸 (单位：米)</div>\r\n          <div class=\"property-field\">\r\n            <label>半径 (Radius)</label>\r\n            <input type=\"number\" id=\"prop-radius\" class=\"body-prop\" value=\"${body.radius.toFixed(2)}\" step=\"0.1\" min=\"0.1\">\r\n          </div>\r\n        </div>\r\n      `;\r\n    } else if (body.shapeType === 'polygon' && body.vertices && body.vertices.length > 0) {\r\n      const verticesHTML = body.vertices.map((v, i) => `\r\n        <div class=\"vertex-field\">\r\n          <label>顶点 ${i + 1}</label>\r\n          <div class=\"input-group\">\r\n            <input type=\"number\" id=\"prop-vertex-${i}-x\" class=\"body-prop vertex-input\" \r\n                   value=\"${v.x.toFixed(2)}\" step=\"0.1\" placeholder=\"X\">\r\n            <input type=\"number\" id=\"prop-vertex-${i}-y\" class=\"body-prop vertex-input\" \r\n                   value=\"${v.y.toFixed(2)}\" step=\"0.1\" placeholder=\"Y\">\r\n          </div>\r\n        </div>\r\n      `).join('');\r\n      \r\n      shapePropertiesHTML = `\r\n        <div class=\"property-group\">\r\n          <div class=\"property-group-title\">多边形顶点 (单位：米)</div>\r\n          ${verticesHTML}\r\n          <div class=\"hint\">提示：顶点坐标相对于物体中心</div>\r\n        </div>\r\n      `;\r\n    }\r\n    \r\n    return `\r\n      <div class=\"object-info\">\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">ID:</span>\r\n          <span class=\"object-info-value\">${body.id}</span>\r\n        </div>\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">类型:</span>\r\n          <span class=\"object-info-value\">刚体 (${body.shapeType})</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">位置坐标 (单位：米)</div>\r\n        <div class=\"property-field\">\r\n          <label>X 坐标</label>\r\n          <input type=\"number\" id=\"prop-position-x\" class=\"body-prop\" value=\"${body.position.x.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>Y 坐标</label>\r\n          <input type=\"number\" id=\"prop-position-y\" class=\"body-prop\" value=\"${body.position.y.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>旋转角度 (度)</label>\r\n          <input type=\"number\" id=\"prop-angle\" class=\"body-prop\" value=\"${(body.angle * 180 / Math.PI).toFixed(2)}\" step=\"1\">\r\n        </div>\r\n      </div>\r\n\r\n      ${shapePropertiesHTML}\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">刚体类型</div>\r\n        <div class=\"property-field\">\r\n          <select id=\"prop-bodyType\" class=\"body-prop\">\r\n            <option value=\"static\" ${body.bodyType === 'static' ? 'selected' : ''}>Static (静态)</option>\r\n            <option value=\"dynamic\" ${body.bodyType === 'dynamic' ? 'selected' : ''}>Dynamic (动态)</option>\r\n            <option value=\"kinematic\" ${body.bodyType === 'kinematic' ? 'selected' : ''}>Kinematic (运动学)</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">物理属性</div>\r\n        <div class=\"property-field\">\r\n          <label>密度 (Density)</label>\r\n          <input type=\"number\" id=\"prop-density\" class=\"body-prop\" value=\"${body.density}\" step=\"0.1\" min=\"0\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>摩擦力 (Friction)</label>\r\n          <input type=\"number\" id=\"prop-friction\" class=\"body-prop\" value=\"${body.friction}\" step=\"0.1\" min=\"0\" max=\"1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>弹性 (Restitution)</label>\r\n          <input type=\"number\" id=\"prop-restitution\" class=\"body-prop\" value=\"${body.restitution}\" step=\"0.1\" min=\"0\" max=\"1\">\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">阻尼</div>\r\n        <div class=\"property-field\">\r\n          <label>线性阻尼</label>\r\n          <input type=\"number\" id=\"prop-linearDamping\" class=\"body-prop\" value=\"${body.linearDamping}\" step=\"0.1\" min=\"0\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>角阻尼</label>\r\n          <input type=\"number\" id=\"prop-angularDamping\" class=\"body-prop\" value=\"${body.angularDamping}\" step=\"0.1\" min=\"0\">\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">其他</div>\r\n        <div class=\"property-field\">\r\n          <label>重力缩放</label>\r\n          <input type=\"number\" id=\"prop-gravityScale\" class=\"body-prop\" value=\"${body.gravityScale}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field property-field-inline\">\r\n          <input type=\"checkbox\" id=\"prop-fixedRotation\" class=\"body-prop\" ${body.fixedRotation ? 'checked' : ''}>\r\n          <label>固定旋转</label>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"btn-group\">\r\n        <button id=\"btn-delete-obj\" class=\"btn\">删除对象</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private generateJointProperties(joint: Joint): string {\r\n    const bodyA = this.objects.find(o => o.id === joint.bodyAId);\r\n    const bodyB = this.objects.find(o => o.id === joint.bodyBId);\r\n    \r\n    return `\r\n      <div class=\"object-info\">\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">ID:</span>\r\n          <span class=\"object-info-value\">${joint.id}</span>\r\n        </div>\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">类型:</span>\r\n          <span class=\"object-info-value\">旋转关节</span>\r\n        </div>\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">Body A:</span>\r\n          <span class=\"object-info-value\">${bodyA ? (bodyA as Body).id.substring(0, 12) + '...' : 'N/A'}</span>\r\n        </div>\r\n        <div class=\"object-info-row\">\r\n          <span class=\"object-info-label\">Body B:</span>\r\n          <span class=\"object-info-value\">${bodyB ? (bodyB as Body).id.substring(0, 12) + '...' : 'N/A'}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">锚点位置（局部坐标，单位：米）</div>\r\n        <div class=\"property-field\">\r\n          <label>锚点 A - X (m)</label>\r\n          <input type=\"number\" id=\"prop-anchorALocalX\" class=\"joint-prop\" value=\"${joint.anchorALocal.x.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>锚点 A - Y (m)</label>\r\n          <input type=\"number\" id=\"prop-anchorALocalY\" class=\"joint-prop\" value=\"${joint.anchorALocal.y.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>锚点 B - X (m)</label>\r\n          <input type=\"number\" id=\"prop-anchorBLocalX\" class=\"joint-prop\" value=\"${joint.anchorBLocal.x.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>锚点 B - Y (m)</label>\r\n          <input type=\"number\" id=\"prop-anchorBLocalY\" class=\"joint-prop\" value=\"${joint.anchorBLocal.y.toFixed(2)}\" step=\"0.1\">\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">旋转关节属性</div>\r\n        <div class=\"property-field property-field-inline\">\r\n          <input type=\"checkbox\" id=\"prop-enableLimit\" class=\"joint-prop\" ${joint.enableLimit ? 'checked' : ''}>\r\n          <label>启用角度限制</label>\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>下限角度 (度)</label>\r\n          <input type=\"number\" id=\"prop-lowerAngle\" class=\"joint-prop\" value=\"${Math.round((joint.lowerAngle || 0) * 180 / Math.PI)}\" step=\"5\">\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>上限角度 (度)</label>\r\n          <input type=\"number\" id=\"prop-upperAngle\" class=\"joint-prop\" value=\"${Math.round((joint.upperAngle || 0) * 180 / Math.PI)}\" step=\"5\">\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">马达控制</div>\r\n        <div class=\"property-field property-field-inline\">\r\n          <input type=\"checkbox\" id=\"prop-enableMotor\" class=\"joint-prop\" ${joint.enableMotor ? 'checked' : ''}>\r\n          <label>启用马达</label>\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>马达速度 (rad/s)</label>\r\n          <input type=\"number\" id=\"prop-motorSpeed\" class=\"joint-prop\" value=\"${(joint.motorSpeed || 0).toFixed(2)}\" step=\"0.1\">\r\n          <div class=\"hint\">正值：逆时针旋转 | 负值：顺时针旋转</div>\r\n        </div>\r\n        <div class=\"property-field\">\r\n          <label>最大扭矩</label>\r\n          <input type=\"number\" id=\"prop-maxMotorTorque\" class=\"joint-prop\" value=\"${joint.maxMotorTorque || 1000}\" step=\"100\" min=\"0\">\r\n          <div class=\"hint\">扭矩越大，马达力量越强</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"property-group\">\r\n        <div class=\"property-group-title\">碰撞设置</div>\r\n        <div class=\"property-field property-field-inline\">\r\n          <input type=\"checkbox\" id=\"prop-collideConnected\" class=\"joint-prop\" ${joint.collideConnected ? 'checked' : ''}>\r\n          <label>允许连接物体碰撞</label>\r\n        </div>\r\n        <div class=\"hint\">勾选：连接的物体会发生碰撞（如人体关节）<br>不勾选：连接的物体穿透彼此（适合特殊效果）</div>\r\n      </div>\r\n\r\n      <div class=\"btn-group\">\r\n        <button id=\"btn-delete-obj\" class=\"btn\">删除对象</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private bindBodyPropertyEvents(): void {\r\n    const updateProp = (id: string, prop: keyof Body, isCheckbox = false) => {\r\n      const elem = document.getElementById(id) as HTMLInputElement;\r\n      if (!elem || !this.selectedObject || this.selectedObject.type !== 'body') return;\r\n      \r\n      elem.addEventListener(isCheckbox ? 'change' : 'input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'body') {\r\n          const body = this.selectedObject as Body;\r\n          const oldValue = (body as any)[prop];\r\n          const newValue = isCheckbox ? elem.checked : (id === 'prop-bodyType' ? elem.value : parseFloat(elem.value));\r\n          \r\n          // 值没变化就不记录\r\n          if (oldValue !== newValue) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              body,\r\n              prop as string,\r\n              oldValue,\r\n              newValue,\r\n              () => {\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    // 位置坐标 X\r\n    const posXInput = document.getElementById('prop-position-x') as HTMLInputElement;\r\n    if (posXInput && this.selectedObject && this.selectedObject.type === 'body') {\r\n      posXInput.addEventListener('input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'body') {\r\n          const body = this.selectedObject as Body;\r\n          const oldX = body.position.x;\r\n          const newX = parseFloat(posXInput.value);\r\n          \r\n          if (oldX !== newX) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              body,\r\n              'position.x',\r\n              oldX,\r\n              newX,\r\n              () => {\r\n                body.position.x = newX;\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // 位置坐标 Y\r\n    const posYInput = document.getElementById('prop-position-y') as HTMLInputElement;\r\n    if (posYInput && this.selectedObject && this.selectedObject.type === 'body') {\r\n      posYInput.addEventListener('input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'body') {\r\n          const body = this.selectedObject as Body;\r\n          const oldY = body.position.y;\r\n          const newY = parseFloat(posYInput.value);\r\n          \r\n          if (oldY !== newY) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              body,\r\n              'position.y',\r\n              oldY,\r\n              newY,\r\n              () => {\r\n                body.position.y = newY;\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // 旋转角度\r\n    const angleInput = document.getElementById('prop-angle') as HTMLInputElement;\r\n    if (angleInput && this.selectedObject && this.selectedObject.type === 'body') {\r\n      angleInput.addEventListener('input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'body') {\r\n          const body = this.selectedObject as Body;\r\n          const oldAngle = body.angle;\r\n          const newAngle = parseFloat(angleInput.value) * Math.PI / 180; // 度转弧度\r\n          \r\n          if (oldAngle !== newAngle) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              body,\r\n              'angle',\r\n              oldAngle,\r\n              newAngle,\r\n              () => {\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // 形状尺寸属性\r\n    updateProp('prop-width', 'width');\r\n    updateProp('prop-height', 'height');\r\n    updateProp('prop-radius', 'radius');\r\n    \r\n    // 多边形顶点编辑\r\n    if (this.selectedObject && this.selectedObject.type === 'body') {\r\n      const body = this.selectedObject as Body;\r\n      if (body.shapeType === 'polygon' && body.vertices) {\r\n        body.vertices.forEach((_, i) => {\r\n          // X 坐标\r\n          const xInput = document.getElementById(`prop-vertex-${i}-x`) as HTMLInputElement;\r\n          if (xInput) {\r\n            xInput.addEventListener('input', () => {\r\n              const newX = parseFloat(xInput.value);\r\n              const oldVertices = JSON.parse(JSON.stringify(body.vertices));\r\n              const newVertices = JSON.parse(JSON.stringify(body.vertices));\r\n              newVertices[i].x = newX;\r\n              \r\n              const cmd = new ModifyPropertyCommand(\r\n                body,\r\n                'vertices',\r\n                oldVertices,\r\n                newVertices,\r\n                () => {\r\n                  this.render();\r\n                  this.updatePropertyPanel();\r\n                }\r\n              );\r\n              this.commandHistory.execute(cmd);\r\n              this.updateUndoRedoButtons();\r\n            });\r\n          }\r\n          \r\n          // Y 坐标\r\n          const yInput = document.getElementById(`prop-vertex-${i}-y`) as HTMLInputElement;\r\n          if (yInput) {\r\n            yInput.addEventListener('input', () => {\r\n              const newY = parseFloat(yInput.value);\r\n              const oldVertices = JSON.parse(JSON.stringify(body.vertices));\r\n              const newVertices = JSON.parse(JSON.stringify(body.vertices));\r\n              newVertices[i].y = newY;\r\n              \r\n              const cmd = new ModifyPropertyCommand(\r\n                body,\r\n                'vertices',\r\n                oldVertices,\r\n                newVertices,\r\n                () => {\r\n                  this.render();\r\n                  this.updatePropertyPanel();\r\n                }\r\n              );\r\n              this.commandHistory.execute(cmd);\r\n              this.updateUndoRedoButtons();\r\n            });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // 物理属性\r\n    updateProp('prop-bodyType', 'bodyType');\r\n    updateProp('prop-density', 'density');\r\n    updateProp('prop-friction', 'friction');\r\n    updateProp('prop-restitution', 'restitution');\r\n    updateProp('prop-linearDamping', 'linearDamping');\r\n    updateProp('prop-angularDamping', 'angularDamping');\r\n    updateProp('prop-gravityScale', 'gravityScale');\r\n    updateProp('prop-fixedRotation', 'fixedRotation', true);\r\n\r\n    document.getElementById('btn-delete-obj')?.addEventListener('click', () => this.deleteSelected());\r\n  }\r\n\r\n  private bindJointPropertyEvents(): void {\r\n    const updateProp = (id: string, prop: keyof Joint, isCheckbox = false, isDegree = false) => {\r\n      const elem = document.getElementById(id) as HTMLInputElement;\r\n      if (!elem || !this.selectedObject || this.selectedObject.type !== 'joint') return;\r\n      \r\n      elem.addEventListener(isCheckbox ? 'change' : 'input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'joint') {\r\n          const joint = this.selectedObject as Joint;\r\n          const oldValue = (joint as any)[prop];\r\n          let newValue: any = isCheckbox ? elem.checked : parseFloat(elem.value);\r\n          if (isDegree) newValue = newValue * Math.PI / 180;\r\n          \r\n          // 值没变化就不记录\r\n          if (oldValue !== newValue) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              joint,\r\n              prop as string,\r\n              oldValue,\r\n              newValue,\r\n              () => {\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    // 锚点位置编辑\r\n    const updateAnchor = (id: string, isAnchorA: boolean, isX: boolean) => {\r\n      const elem = document.getElementById(id) as HTMLInputElement;\r\n      if (!elem || !this.selectedObject || this.selectedObject.type !== 'joint') return;\r\n      \r\n      elem.addEventListener('input', () => {\r\n        if (this.selectedObject && this.selectedObject.type === 'joint') {\r\n          const joint = this.selectedObject as Joint;\r\n          const anchor = isAnchorA ? joint.anchorALocal : joint.anchorBLocal;\r\n          const prop = isAnchorA ? 'anchorALocal' : 'anchorBLocal';\r\n          const oldValue = { x: anchor.x, y: anchor.y };\r\n          const newValue = { x: anchor.x, y: anchor.y };\r\n          \r\n          if (isX) {\r\n            newValue.x = parseFloat(elem.value);\r\n          } else {\r\n            newValue.y = parseFloat(elem.value);\r\n          }\r\n          \r\n          if (oldValue.x !== newValue.x || oldValue.y !== newValue.y) {\r\n            const cmd = new ModifyPropertyCommand(\r\n              joint,\r\n              prop,\r\n              oldValue,\r\n              newValue,\r\n              () => {\r\n                this.render();\r\n                this.updatePropertyPanel();\r\n              }\r\n            );\r\n            this.commandHistory.execute(cmd);\r\n            this.updateUndoRedoButtons();\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    updateAnchor('prop-anchorALocalX', true, true);\r\n    updateAnchor('prop-anchorALocalY', true, false);\r\n    updateAnchor('prop-anchorBLocalX', false, true);\r\n    updateAnchor('prop-anchorBLocalY', false, false);\r\n\r\n    // 只绑定旋转关节属性\r\n    updateProp('prop-enableLimit', 'enableLimit', true);\r\n    updateProp('prop-lowerAngle', 'lowerAngle', false, true);\r\n    updateProp('prop-upperAngle', 'upperAngle', false, true);\r\n    \r\n    // 马达属性\r\n    updateProp('prop-enableMotor', 'enableMotor', true);\r\n    updateProp('prop-motorSpeed', 'motorSpeed', false);\r\n    updateProp('prop-maxMotorTorque', 'maxMotorTorque', false);\r\n    \r\n    // 其他属性\r\n    updateProp('prop-collideConnected', 'collideConnected', true);\r\n\r\n    document.getElementById('btn-delete-obj')?.addEventListener('click', () => this.deleteSelected());\r\n  }\r\n\r\n  // ==================== 撤销/重做 ====================\r\n\r\n  private updateUndoRedoButtons(): void {\r\n    const undoBtn = document.getElementById('btn-undo') as HTMLButtonElement | null;\r\n    const redoBtn = document.getElementById('btn-redo') as HTMLButtonElement | null;\r\n    \r\n    if (undoBtn) {\r\n      undoBtn.disabled = !this.commandHistory.canUndo();\r\n    }\r\n    if (redoBtn) {\r\n      redoBtn.disabled = !this.commandHistory.canRedo();\r\n    }\r\n  }\r\n\r\n  private undo(): void {\r\n    this.commandHistory.undo();\r\n    this.updateUndoRedoButtons();\r\n    this.updateStatus('撤销操作', '', '已撤销');\r\n  }\r\n\r\n  private redo(): void {\r\n    this.commandHistory.redo();\r\n    this.updateUndoRedoButtons();\r\n    this.updateStatus('重做操作', '', '已重做');\r\n  }\r\n\r\n  // ==================== 状态更新 ====================\r\n\r\n  private updateStatus(...messages: string[]): void {\r\n    const statusTool = document.getElementById('status-tool');\r\n    const statusObjects = document.getElementById('status-objects');\r\n    const statusCoords = document.getElementById('status-coords');\r\n    const statusMessage = document.getElementById('status-message');\r\n\r\n    if (messages[0] && statusTool) statusTool.textContent = messages[0];\r\n    if (statusObjects) statusObjects.textContent = `对象: ${this.objects.length}`;\r\n    if (messages[1] && statusCoords) statusCoords.textContent = messages[1];\r\n    if (messages[2] && statusMessage) statusMessage.textContent = messages[2];\r\n  }\r\n\r\n  private newMap(): void {\r\n    if (confirm('确定要新建地图吗？当前未保存的内容将丢失。')) {\r\n      this.objects = [];\r\n      this.selectedObject = null;\r\n      this.updatePropertyPanel();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  private saveMap(): void {\r\n    if (this.objects.length === 0) {\r\n      alert('没有可保存的对象');\r\n      return;\r\n    }\r\n    const data = JSON.stringify(this.objects, null, 2);\r\n    downloadFile(data, 'map.json');\r\n    alert('地图保存成功！');\r\n  }\r\n\r\n  private loadMap(): void {\r\n    const fileInput = document.getElementById('file-input') as HTMLInputElement;\r\n    fileInput?.click();\r\n  }\r\n\r\n  private async loadFromFile(file: File): Promise<void> {\r\n    try {\r\n      const text = await file.text();\r\n      const data = JSON.parse(text);\r\n      \r\n      // 检查是否是 Box2D 导出格式\r\n      if (data.world_settings && data.bodies && data.joints) {\r\n        alert('检测到 Box2D 导出格式，但目前不支持从导出文件导入。\\n请使用\"保存地图\"生成的 map.json 文件。');\r\n        return;\r\n      }\r\n      \r\n      // 验证数据格式（地图保存格式）\r\n      if (!Array.isArray(data)) {\r\n        throw new Error('文件格式错误：数据必须是数组格式');\r\n      }\r\n      \r\n      // 验证数组中的对象是否有必要的字段\r\n      for (const obj of data) {\r\n        if (!obj.id || !obj.type) {\r\n          throw new Error('文件格式错误：对象缺少必要字段（id 或 type）');\r\n        }\r\n      }\r\n      \r\n      this.objects = data;\r\n      this.selectedObject = null;\r\n      this.commandHistory = new CommandHistory(); // 清空撤销历史\r\n      this.updateUndoRedoButtons();\r\n      this.updatePropertyPanel();\r\n      this.render();\r\n      alert('文件加载成功！');\r\n    } catch (error) {\r\n      console.error('加载文件错误:', error);\r\n      alert('加载文件失败: ' + (error instanceof Error ? error.message : String(error)));\r\n    }\r\n  }\r\n\r\n  private exportBox2D(): void {\r\n    const box2dData = {\r\n      world_settings: {\r\n        gravity: [0, -9.8],  // 标准重力加速度 9.8 m/s²，Y向下（负值）\r\n        allow_sleeping: true,\r\n        auto_clear_forces: true\r\n      },\r\n      bodies: this.objects\r\n        .filter(o => o.type === 'body')\r\n        .map(body => this.bodyToBox2D(body as Body)),\r\n      joints: this.objects\r\n        .filter(o => o.type === 'joint')\r\n        .map(joint => this.jointToBox2D(joint as Joint))\r\n    };\r\n\r\n    const json = JSON.stringify(box2dData, null, 2);\r\n    downloadFile(json, 'box2d_export.json');\r\n  }\r\n\r\n  private bodyToBox2D(body: Body): any {\r\n    const fixtures: any[] = [];\r\n    \r\n    // 数据已经是 Box2D 坐标，直接使用\r\n    if (body.shapeType === 'box' && body.width && body.height) {\r\n      fixtures.push({\r\n        shape: {\r\n          type: 'box',\r\n          params: {\r\n            width: body.width,    // 已经是米\r\n            height: body.height   // 已经是米\r\n          }\r\n        },\r\n        fixture_def: {\r\n          density: body.density,\r\n          friction: body.friction,\r\n          restitution: body.restitution,\r\n          is_sensor: false,\r\n          filter_category_bits: 1,\r\n          filter_mask_bits: 65535,\r\n          filter_group_index: 0\r\n        }\r\n      });\r\n    } else if (body.shapeType === 'circle' && body.radius) {\r\n      fixtures.push({\r\n        shape: {\r\n          type: 'circle',\r\n          params: {\r\n            radius: body.radius   // 已经是米\r\n          }\r\n        },\r\n        fixture_def: {\r\n          density: body.density,\r\n          friction: body.friction,\r\n          restitution: body.restitution,\r\n          is_sensor: false,\r\n          filter_category_bits: 1,\r\n          filter_mask_bits: 65535,\r\n          filter_group_index: 0\r\n        }\r\n      });\r\n    } else if (body.shapeType === 'polygon' && body.vertices) {\r\n      fixtures.push({\r\n        shape: {\r\n          type: 'polygon',\r\n          params: {\r\n            vertices: body.vertices.map(v => [v.x, v.y])  // 已经是米\r\n          }\r\n        },\r\n        fixture_def: {\r\n          density: body.density,\r\n          friction: body.friction,\r\n          restitution: body.restitution,\r\n          is_sensor: false,\r\n          filter_category_bits: 1,\r\n          filter_mask_bits: 65535,\r\n          filter_group_index: 0\r\n        }\r\n      });\r\n    }\r\n\r\n    return {\r\n      id: body.id,\r\n      body_def: {\r\n        type: body.bodyType,\r\n        position: [body.position.x, body.position.y],  // 已经是米，Y向上\r\n        angle: body.angle,  // 已经是逆时针为正\r\n        linear_velocity: [0, 0],\r\n        angular_velocity: 0,\r\n        linear_damping: body.linearDamping,\r\n        angular_damping: body.angularDamping,\r\n        allow_sleep: true,\r\n        awake: true,\r\n        fixed_rotation: body.fixedRotation,\r\n        bullet: false,\r\n        gravity_scale: body.gravityScale\r\n      },\r\n      fixtures,\r\n      visual_properties: {},\r\n      user_data: {}\r\n    };\r\n  }\r\n\r\n  private jointToBox2D(joint: Joint): any {\r\n    const bodyA = this.objects.find(o => o.id === joint.bodyAId) as Body;\r\n    const bodyB = this.objects.find(o => o.id === joint.bodyBId) as Body;\r\n\r\n    if (!bodyA || !bodyB) return null;\r\n\r\n    // 现在锚点已经是局部坐标了，直接使用\r\n    const base = {\r\n      id: joint.id,\r\n      joint_type: 'revolute', // 只导出旋转关节\r\n      body_a: joint.bodyAId,\r\n      body_b: joint.bodyBId,\r\n      visual_properties: {},\r\n      user_data: {}\r\n    };\r\n\r\n    // 数据已经是 Box2D 坐标（局部坐标，米），直接使用\r\n    return {\r\n      ...base,\r\n      joint_def: {\r\n        local_anchor_a: [joint.anchorALocal.x, joint.anchorALocal.y],  // 已经是米\r\n        local_anchor_b: [joint.anchorBLocal.x, joint.anchorBLocal.y],  // 已经是米\r\n        reference_angle: bodyB.angle - bodyA.angle,\r\n        enable_limit: joint.enableLimit || false,\r\n        lower_angle: joint.lowerAngle || -Math.PI / 2,\r\n        upper_angle: joint.upperAngle || Math.PI / 2,\r\n        enable_motor: false,\r\n        motor_speed: 0,\r\n        max_motor_torque: 0,\r\n        collide_connected: false\r\n      }\r\n    };\r\n  }\r\n\r\n  // ==================== 物理预览 ====================\r\n\r\n  private disableToolbar(disabled: boolean): void {\r\n    // 禁用/启用所有工具按钮\r\n    document.querySelectorAll('.tool-btn').forEach(btn => {\r\n      (btn as HTMLButtonElement).disabled = disabled;\r\n      if (disabled) {\r\n        btn.classList.add('disabled');\r\n      } else {\r\n        btn.classList.remove('disabled');\r\n      }\r\n    });\r\n    \r\n    // 禁用/启用文件操作按钮\r\n    const fileButtons = ['btn-new', 'btn-save', 'btn-load', 'btn-export', 'btn-undo', 'btn-redo'];\r\n    fileButtons.forEach(id => {\r\n      const btn = document.getElementById(id) as HTMLButtonElement;\r\n      if (btn) {\r\n        btn.disabled = disabled;\r\n      }\r\n    });\r\n  }\r\n\r\n  private togglePreview(): void {\r\n    if (this.isPreviewMode) {\r\n      this.exitPreview();\r\n    } else {\r\n      this.startPreview();\r\n    }\r\n  }\r\n\r\n  private startPreview(): void {\r\n    // 检查 Box2D 是否加载（旧版 Box2D Flash API）\r\n    if (typeof (window as any).b2World === 'undefined') {\r\n      alert('Box2D 物理引擎未加载！\\n\\n请确认：\\n1. public/box2d-js/lib/box2d.js 文件存在\\n2. 刷新页面重新加载\\n3. 查看控制台是否有加载错误');\r\n      console.error('Box2D 加载检查失败 - b2World 未定义');\r\n      console.log('可用的全局对象:', Object.keys(window).filter(k => k.includes('b2')));\r\n      return;\r\n    }\r\n\r\n    // 如果没有物体，提示用户\r\n    if (this.objects.length === 0) {\r\n      alert('场景中没有物体！请先创建一些物体。');\r\n      return;\r\n    }\r\n\r\n    console.log('开始物理预览...');\r\n    console.log('Box2D 版本: Flash 移植版');\r\n    \r\n    this.isPreviewMode = true;\r\n    this.previewPaused = false;\r\n    \r\n    // 保存所有物体的原始状态（用于重置）\r\n    this.previewOriginalState = [];\r\n    for (const obj of this.objects) {\r\n      if (obj.type === 'body') {\r\n        const body = obj as Body;\r\n        this.previewOriginalState.push({\r\n          id: body.id,\r\n          position: { x: body.position.x, y: body.position.y },\r\n          angle: body.angle\r\n        });\r\n      }\r\n    }\r\n    \r\n    // 隐藏设计UI，显示预览UI\r\n    this.canvas.style.cursor = 'default';\r\n    document.getElementById('preview-controls')!.style.display = 'flex';\r\n    document.getElementById('property-panel')!.style.display = 'none';\r\n    \r\n    // 禁用所有工具栏按钮和文件操作按钮\r\n    this.disableToolbar(true);\r\n    \r\n    // 设置预览按钮初始状态（播放中，显示暂停按钮）\r\n    document.getElementById('btn-preview-play')!.style.display = 'none';\r\n    document.getElementById('btn-preview-pause')!.style.display = 'inline-block';\r\n    \r\n    // 保存当前的坐标系参数（用于 Box2D 同步）\r\n    this.previewPPM = PPM;\r\n    this.previewOriginOffsetX = ORIGIN_OFFSET_X;\r\n    this.previewOriginOffsetY = ORIGIN_OFFSET_Y;\r\n    console.log(`保存坐标系快照: PPM=${this.previewPPM}, OriginX=${this.previewOriginOffsetX.toFixed(2)}, OriginY=${this.previewOriginOffsetY.toFixed(2)}`);\r\n    \r\n    // 初始化 Box2D 世界\r\n    this.initBox2DWorld();\r\n    \r\n    // 开始动画循环\r\n    this.startPreviewAnimation();\r\n    \r\n    this.updateStatus('物理预览模式', `物体数: ${this.objects.length}`, '按 ESC 或点击退出');\r\n  }\r\n\r\n  private initBox2DWorld(): void {\r\n    console.log('=== 初始化 Box2D 世界 ===');\r\n    console.log(`场景对象总数: ${this.objects.length}`);\r\n    \r\n    // 首先清空旧的映射（如果有）\r\n    this.box2dBodies.clear();\r\n    this.box2dJoints.clear();\r\n    console.log('已清空旧的 Box2D 映射');\r\n    \r\n    // 使用旧版 Box2D Flash API\r\n    const b2AABB = (window as any).b2AABB;\r\n    const b2World = (window as any).b2World;\r\n    const b2Vec2 = (window as any).b2Vec2;\r\n    \r\n    // 创建世界边界（AABB）\r\n    const worldAABB = new b2AABB();\r\n    worldAABB.minVertex.Set(-1000, -1000);\r\n    worldAABB.maxVertex.Set(1000, 1000);\r\n    \r\n    // 创建重力（统一使用 Y 向上为正的坐标系）\r\n    // 标准重力: 9.8 m/s² 向下\r\n    // Y 向上为正，所以向下是负值\r\n    const gravityValue = -9.8 * this.previewPPM; // 负值表示向下\r\n    const gravity = new b2Vec2(0, gravityValue);\r\n    const doSleep = true;\r\n    \r\n    console.log(`重力设置: ${gravityValue.toFixed(1)} Box2D单位/s² (= -9.8 m/s² 向下, Y轴向上, PPM=${this.previewPPM})`);\r\n    \r\n    // 创建世界\r\n    this.box2dWorld = new b2World(worldAABB, gravity, doSleep);\r\n    console.log('Box2D 世界已创建');\r\n    \r\n    // 统计物体和关节数量\r\n    const bodies = this.objects.filter(o => o.type === 'body');\r\n    const joints = this.objects.filter(o => o.type === 'joint');\r\n    console.log(`准备创建: ${bodies.length} 个物体, ${joints.length} 个关节`);\r\n    \r\n    // 创建所有刚体\r\n    let bodySuccessCount = 0;\r\n    let bodyFailCount = 0;\r\n    for (const obj of this.objects) {\r\n      if (obj.type === 'body') {\r\n        const body = obj as Body;\r\n        const b2Body = this.createBox2DBody(body);\r\n        if (b2Body) {\r\n          this.box2dBodies.set(body.id, b2Body);\r\n          bodySuccessCount++;\r\n        } else {\r\n          bodyFailCount++;\r\n        }\r\n      }\r\n    }\r\n    \r\n    console.log(`物体创建完成: ${bodySuccessCount} 成功, ${bodyFailCount} 失败`);\r\n    console.log(`当前 box2dBodies Map 大小: ${this.box2dBodies.size}`);\r\n    console.log(`box2dBodies 的 keys:`, Array.from(this.box2dBodies.keys()));\r\n    \r\n    // 创建所有关节\r\n    let jointSuccessCount = 0;\r\n    let jointFailCount = 0;\r\n    for (const obj of this.objects) {\r\n      if (obj.type === 'joint') {\r\n        const joint = obj as Joint;\r\n        const b2Joint = this.createBox2DJoint(joint);\r\n        if (b2Joint) {\r\n          this.box2dJoints.set(joint.id, b2Joint);\r\n          jointSuccessCount++;\r\n        } else {\r\n          jointFailCount++;\r\n        }\r\n      }\r\n    }\r\n    \r\n    console.log(`关节创建完成: ${jointSuccessCount} 成功, ${jointFailCount} 失败`);\r\n    console.log(`=== Box2D 世界初始化完成 ===`);\r\n    console.log(`最终结果: ${this.box2dBodies.size} 个物体, ${this.box2dJoints.size} 个关节`);\r\n  }\r\n\r\n  private createBox2DBody(body: Body): any {\r\n    console.log(`创建 Box2D Body: id=${body.id}, type=${body.bodyType}, shape=${body.shapeType}`);\r\n    \r\n    // 使用旧版 Box2D Flash API\r\n    const b2BodyDef = (window as any).b2BodyDef;\r\n    const b2BoxDef = (window as any).b2BoxDef;\r\n    const b2CircleDef = (window as any).b2CircleDef;\r\n    const b2PolyDef = (window as any).b2PolyDef;\r\n    \r\n    const bodyDef = new b2BodyDef();\r\n    \r\n    // 创建形状定义\r\n    let shapeDef: any = null;\r\n    \r\n    if (body.shapeType === 'box' && body.width && body.height) {\r\n      shapeDef = new b2BoxDef();\r\n      // extents 是半宽和半高（像素）\r\n      // 重要：使用保存的 PPM 参数\r\n      const halfWidth = body.width * this.previewPPM / 2;\r\n      const halfHeight = body.height * this.previewPPM / 2;\r\n      shapeDef.extents.Set(halfWidth, halfHeight);\r\n      console.log(`  - 矩形: 半宽=${halfWidth.toFixed(2)}px, 半高=${halfHeight.toFixed(2)}px [使用保存的 PPM=${this.previewPPM}]`);\r\n    } else if (body.shapeType === 'circle' && body.radius) {\r\n      shapeDef = new b2CircleDef();\r\n      // 重要：使用保存的 PPM 参数\r\n      shapeDef.radius = body.radius * this.previewPPM;\r\n      console.log(`  - 圆形: 半径=${shapeDef.radius.toFixed(2)}px [使用保存的 PPM=${this.previewPPM}]`);\r\n    } else if (body.shapeType === 'polygon' && body.vertices && body.vertices.length >= 3) {\r\n      // Box2D 旧版对多边形顶点数有限制（最多 8 个）\r\n      const maxVertices = 8;\r\n      if (body.vertices.length > maxVertices) {\r\n        console.error(`❌ 多边形顶点数超出限制: ${body.vertices.length} > ${maxVertices}`);\r\n        console.error(`   Box2D 旧版最多支持 ${maxVertices} 个顶点的多边形`);\r\n        return null;\r\n      }\r\n      \r\n      shapeDef = new b2PolyDef();\r\n      shapeDef.vertexCount = body.vertices.length;\r\n      \r\n      console.log(`  - 准备创建多边形: ${body.vertices.length} 个顶点`);\r\n      \r\n      // 多边形顶点（相对于物体中心）\r\n      // 重要：使用保存的 PPM 参数\r\n      // 注意：旧版 Box2D 需要使用 .Set() 方法设置顶点！\r\n      // 统一使用 Y 向上的坐标系，不翻转\r\n      for (let i = 0; i < body.vertices.length; i++) {\r\n        const v = body.vertices[i];\r\n        const vx = v.x * this.previewPPM;\r\n        const vy = v.y * this.previewPPM;  // Y 向上，不翻转\r\n        \r\n        // 使用 Set() 方法（旧版 API 要求）\r\n        shapeDef.vertices[i].Set(vx, vy);\r\n        console.log(`    顶点[${i}]: 局部(${v.x.toFixed(2)}, ${v.y.toFixed(2)}) -> Box2D(${vx.toFixed(2)}, ${vy.toFixed(2)})`);\r\n      }\r\n      \r\n      console.log(`  - 多边形顶点已设置 [使用保存的 PPM=${this.previewPPM}, Y向上]`);\r\n    }\r\n    \r\n    if (!shapeDef) {\r\n      console.error(`❌ 无法创建形状: ${body.shapeType}, width=${body.width}, height=${body.height}, radius=${body.radius}`);\r\n      return null;\r\n    }\r\n    \r\n    // 设置物理属性\r\n    shapeDef.density = body.bodyType === 'static' ? 0 : body.density;\r\n    shapeDef.friction = body.friction;\r\n    shapeDef.restitution = body.restitution;\r\n    console.log(`  - 物理属性: density=${shapeDef.density}, friction=${shapeDef.friction}, restitution=${shapeDef.restitution}`);\r\n    \r\n    // 添加形状到 body 定义（旧版必须先添加形状）\r\n    bodyDef.AddShape(shapeDef);\r\n    \r\n    // 设置位置（统一使用 Y 向上的坐标系）\r\n    // 重要：使用保存的坐标系参数，确保创建和同步使用相同的参数\r\n    const canvasX = (body.position.x - this.previewOriginOffsetX) * this.previewPPM + this.canvas.width / 2;\r\n    const canvasY = (body.position.y - this.previewOriginOffsetY) * this.previewPPM + this.canvas.height / 2; // Y向上，不翻转\r\n    bodyDef.position.Set(canvasX, canvasY);\r\n    console.log(`  - 位置: 世界(${body.position.x.toFixed(2)}, ${body.position.y.toFixed(2)}) -> Box2D(${canvasX.toFixed(0)}, ${canvasY.toFixed(0)}) [Y向上]`);\r\n    \r\n    // 设置旋转（统一使用逆时针为正）\r\n    bodyDef.rotation = body.angle; // Y向上，角度不反向\r\n    console.log(`  - 角度: ${(body.angle * 180 / Math.PI).toFixed(1)}° -> Box2D ${(bodyDef.rotation * 180 / Math.PI).toFixed(1)}°`);\r\n    \r\n    // 创建刚体\r\n    const b2Body = this.box2dWorld.CreateBody(bodyDef);\r\n    \r\n    if (b2Body) {\r\n      console.log(`✅ Body ${body.id} 创建成功`);\r\n      // 验证物体是否有形状\r\n      const shapeList = b2Body.GetShapeList();\r\n      if (shapeList) {\r\n        console.log(`  - 物体有形状定义: type=${shapeList.m_type}`);\r\n      } else {\r\n        console.warn(`  - ⚠️ 警告：物体没有形状定义！`);\r\n      }\r\n      // 验证物体类型\r\n      console.log(`  - 物体类型: ${body.bodyType} (static的质量应该为无穷大)`);\r\n    } else {\r\n      console.error(`❌ Body ${body.id} 创建失败！CreateBody 返回 null`);\r\n      console.error(`  - 详细信息: type=${body.bodyType}, shape=${body.shapeType}`);\r\n      console.error(`  - bodyDef:`, bodyDef);\r\n      console.error(`  - shapeDef:`, shapeDef);\r\n    }\r\n    \r\n    return b2Body;\r\n  }\r\n\r\n  private createBox2DJoint(joint: Joint): any {\r\n    console.log(`创建 Box2D Joint: id=${joint.id}, type=${joint.jointType}, bodyA=${joint.bodyAId}, bodyB=${joint.bodyBId}`);\r\n    \r\n    // 使用旧版 Box2D Flash API\r\n    const b2RevoluteJointDef = (window as any).b2RevoluteJointDef;\r\n    \r\n    const bodyA = this.box2dBodies.get(joint.bodyAId);\r\n    const bodyB = this.box2dBodies.get(joint.bodyBId);\r\n    \r\n    if (!bodyA) {\r\n      console.error(`❌ 关节 ${joint.id} 的 bodyA (${joint.bodyAId}) 未找到！`);\r\n      console.log(`  - 可用的 bodies:`, Array.from(this.box2dBodies.keys()));\r\n      return null;\r\n    }\r\n    \r\n    if (!bodyB) {\r\n      console.error(`❌ 关节 ${joint.id} 的 bodyB (${joint.bodyBId}) 未找到！`);\r\n      console.log(`  - 可用的 bodies:`, Array.from(this.box2dBodies.keys()));\r\n      return null;\r\n    }\r\n    \r\n    console.log(`  - bodyA 和 bodyB 都已找到`);\r\n    \r\n    if (joint.jointType === 'revolute') {\r\n      // 找到对应的 Body 对象\r\n      const bodyAObj = this.objects.find(o => o.id === joint.bodyAId) as Body;\r\n      const bodyBObj = this.objects.find(o => o.id === joint.bodyBId) as Body;\r\n      \r\n      if (!bodyAObj || !bodyBObj) {\r\n        console.error(`❌ 关节 ${joint.id} 对应的 Body 对象未找到！bodyAObj=${!!bodyAObj}, bodyBObj=${!!bodyBObj}`);\r\n        return null;\r\n      }\r\n      \r\n      console.log(`  - Body 对象: bodyA pos=(${bodyAObj.position.x.toFixed(2)}, ${bodyAObj.position.y.toFixed(2)}), bodyB pos=(${bodyBObj.position.x.toFixed(2)}, ${bodyBObj.position.y.toFixed(2)})`);\r\n      \r\n      // 创建旋转关节定义\r\n      const jointDef = new b2RevoluteJointDef();\r\n      jointDef.body1 = bodyA;\r\n      jointDef.body2 = bodyB;\r\n      \r\n      // 将局部锚点转换为世界坐标（我们的坐标系，米）\r\n      const anchorAWorld = localToWorld(\r\n        joint.anchorALocal.x,\r\n        joint.anchorALocal.y,\r\n        bodyAObj.position.x,\r\n        bodyAObj.position.y,\r\n        bodyAObj.angle\r\n      );\r\n      \r\n      // 将世界坐标转换为 Box2D 坐标（Y 向上，不翻转）\r\n      // 重要：使用保存的坐标系参数，确保与物体创建时使用相同的参数\r\n      const anchorCanvasX = (anchorAWorld.x - this.previewOriginOffsetX) * this.previewPPM + this.canvas.width / 2;\r\n      const anchorCanvasY = (anchorAWorld.y - this.previewOriginOffsetY) * this.previewPPM + this.canvas.height / 2; // Y 向上，不翻转\r\n      \r\n      // 设置锚点（旧版使用 anchorPoint）\r\n      jointDef.anchorPoint.Set(anchorCanvasX, anchorCanvasY);\r\n      \r\n      console.log(`  - 锚点: 局部(${joint.anchorALocal.x.toFixed(2)}, ${joint.anchorALocal.y.toFixed(2)}) -> 世界(${anchorAWorld.x.toFixed(2)}, ${anchorAWorld.y.toFixed(2)}) -> Box2D(${anchorCanvasX.toFixed(0)}, ${anchorCanvasY.toFixed(0)}) [Y向上]`);      \r\n      // 角度限制（旧版 API 完全支持！）\r\n      if (joint.enableLimit) {\r\n        jointDef.enableLimit = true;\r\n        jointDef.lowerAngle = joint.lowerAngle || -Math.PI / 2;\r\n        jointDef.upperAngle = joint.upperAngle || Math.PI / 2;\r\n        console.log(`  - 角度限制: ${(jointDef.lowerAngle * 180 / Math.PI).toFixed(0)}° 到 ${(jointDef.upperAngle * 180 / Math.PI).toFixed(0)}°`);\r\n      }\r\n      \r\n      // 马达功能（旧版 API 完全支持！）\r\n      if (joint.enableMotor) {\r\n        jointDef.enableMotor = true;\r\n        jointDef.motorSpeed = joint.motorSpeed || 0;\r\n        jointDef.motorTorque = joint.maxMotorTorque || 1000; // 旧版使用 motorTorque 而非 maxMotorTorque\r\n        console.log(`  - 马达: 速度=${jointDef.motorSpeed.toFixed(2)} rad/s, 扭矩=${jointDef.motorTorque}`);\r\n      }\r\n      \r\n      // 碰撞连接\r\n      jointDef.collideConnected = joint.collideConnected || false;\r\n      console.log(`  - 碰撞连接: ${jointDef.collideConnected}`);\r\n      \r\n      // 创建关节\r\n      try {\r\n        const b2Joint = this.box2dWorld.CreateJoint(jointDef);\r\n        if (b2Joint) {\r\n          console.log(`✅ Joint ${joint.id} 创建成功`);\r\n          return b2Joint;\r\n        } else {\r\n          console.error(`❌ Joint ${joint.id} 创建失败！CreateJoint 返回 null`);\r\n          return null;\r\n        }\r\n      } catch (error) {\r\n        console.error(`❌ Joint ${joint.id} 创建异常:`, error);\r\n        return null;\r\n      }\r\n    }\r\n    \r\n    console.warn(`⚠️ 不支持的关节类型: ${joint.jointType}`);\r\n    return null;\r\n  }\r\n\r\n  private startPreviewAnimation(): void {\r\n    const animate = () => {\r\n      if (!this.isPreviewMode) return;\r\n      \r\n      if (!this.previewPaused) {\r\n        // 步进物理模拟（旧版 API）\r\n        // 参数：timeStep, iterations（旧版只有一个迭代参数）\r\n        this.box2dWorld.Step(1 / 60, 10);\r\n        \r\n        // 同步 Box2D 状态到我们的对象\r\n        this.syncBox2DToObjects();\r\n      }\r\n      \r\n      // 渲染\r\n      this.render();\r\n      \r\n      // 继续动画\r\n      this.previewAnimationId = requestAnimationFrame(animate);\r\n    };\r\n    \r\n    animate();\r\n  }\r\n\r\n  private syncBox2DToObjects(): void {\r\n    for (const [id, b2Body] of this.box2dBodies.entries()) {\r\n      const body = this.objects.find(o => o.id === id) as Body;\r\n      if (body) {\r\n        // 旧版 API：直接访问 m_position 和 m_rotation\r\n        const pos = b2Body.m_position;\r\n        const angle = b2Body.m_rotation;\r\n        \r\n        // 从 Box2D 坐标转回世界坐标（Box2D 单位 -> 米，Y 向上不翻转）\r\n        // 重要：使用保存的坐标系参数，而不是当前的参数\r\n        // 这样即使用户在预览时拖动或缩放视图，Box2D 同步也是正确的\r\n        const canvasX = pos.x;\r\n        const canvasY = pos.y;\r\n        \r\n        // 使用保存的坐标系参数进行转换\r\n        const worldX = (canvasX - this.canvas.width / 2) / this.previewPPM + this.previewOriginOffsetX;\r\n        const worldY = (canvasY - this.canvas.height / 2) / this.previewPPM + this.previewOriginOffsetY; // Y 向上，不翻转\r\n        \r\n        body.position.x = worldX;\r\n        body.position.y = worldY;\r\n        body.angle = angle; // Y 向上，角度不反向\r\n      }\r\n    }\r\n  }\r\n\r\n  private pausePreview(): void {\r\n    this.previewPaused = true;\r\n    document.getElementById('btn-preview-play')!.style.display = 'inline-block';\r\n    document.getElementById('btn-preview-pause')!.style.display = 'none';\r\n  }\r\n\r\n  private resumePreview(): void {\r\n    this.previewPaused = false;\r\n    document.getElementById('btn-preview-play')!.style.display = 'none';\r\n    document.getElementById('btn-preview-pause')!.style.display = 'inline-block';\r\n  }\r\n\r\n  private rebuildBox2DWorldWithNewScale(): void {\r\n    console.log('=== 缩放变化，重建 Box2D 世界 ===');\r\n    console.log(`新的 PPM: ${PPM}, 新的 ORIGIN_OFFSET: (${ORIGIN_OFFSET_X.toFixed(2)}, ${ORIGIN_OFFSET_Y.toFixed(2)})`);\r\n    \r\n    // 暂停模拟（不停止动画循环）\r\n    const wasPaused = this.previewPaused;\r\n    this.previewPaused = true;\r\n    \r\n    // 保存当前所有物体的物理状态（位置、角度、速度）\r\n    const currentStates: Array<{\r\n      id: string;\r\n      position: Vector2;\r\n      angle: number;\r\n      linearVelocity?: { x: number; y: number };\r\n      angularVelocity?: number;\r\n    }> = [];\r\n    \r\n    for (const [id, b2Body] of this.box2dBodies.entries()) {\r\n      const body = this.objects.find(o => o.id === id) as Body;\r\n      if (body) {\r\n        // 保存当前的位置和角度（已经从 Box2D 同步到 objects）\r\n        const state: any = {\r\n          id: body.id,\r\n          position: { x: body.position.x, y: body.position.y },\r\n          angle: body.angle\r\n        };\r\n        \r\n        // 保存速度（如果是动态物体）\r\n        if (body.bodyType === 'dynamic' && b2Body.m_linearVelocity) {\r\n          state.linearVelocity = {\r\n            x: b2Body.m_linearVelocity.x,\r\n            y: b2Body.m_linearVelocity.y\r\n          };\r\n          state.angularVelocity = b2Body.m_angularVelocity || 0;\r\n        }\r\n        \r\n        currentStates.push(state);\r\n      }\r\n    }\r\n    \r\n    console.log(`已保存 ${currentStates.length} 个物体的当前状态`);\r\n    \r\n    // 销毁旧的 Box2D 世界\r\n    if (this.box2dWorld) {\r\n      this.box2dWorld = null;\r\n    }\r\n    \r\n    // 更新坐标系快照为新的值\r\n    this.previewPPM = PPM;\r\n    this.previewOriginOffsetX = ORIGIN_OFFSET_X;\r\n    this.previewOriginOffsetY = ORIGIN_OFFSET_Y;\r\n    console.log(`更新坐标系快照: PPM=${this.previewPPM}, OriginX=${this.previewOriginOffsetX.toFixed(2)}, OriginY=${this.previewOriginOffsetY.toFixed(2)}`);\r\n    \r\n    // 重新初始化 Box2D 世界（使用新的坐标系参数）\r\n    this.initBox2DWorld();\r\n    \r\n    // 恢复物体的速度（如果有）\r\n    for (const state of currentStates) {\r\n      const b2Body = this.box2dBodies.get(state.id);\r\n      if (b2Body && state.linearVelocity) {\r\n        // 速度单位是画布像素/秒，不需要根据 PPM 缩放\r\n        b2Body.m_linearVelocity.Set(state.linearVelocity.x, state.linearVelocity.y);\r\n        b2Body.m_angularVelocity = state.angularVelocity || 0;\r\n        console.log(`恢复物体 ${state.id} 的速度: (${state.linearVelocity.x.toFixed(2)}, ${state.linearVelocity.y.toFixed(2)}), 角速度: ${state.angularVelocity}`);\r\n      }\r\n    }\r\n    \r\n    // 恢复暂停状态\r\n    this.previewPaused = wasPaused;\r\n    \r\n    // 渲染新的状态\r\n    this.render();\r\n    \r\n    console.log('=== Box2D 世界重建完成 ===');\r\n  }\r\n\r\n  private resetPreview(): void {\r\n    console.log('=== 重置物理预览 ===');\r\n    \r\n    // 停止当前模拟\r\n    if (this.previewAnimationId) {\r\n      cancelAnimationFrame(this.previewAnimationId);\r\n      this.previewAnimationId = null;\r\n      console.log('动画循环已停止');\r\n    }\r\n    \r\n    // 销毁旧的 Box2D 世界\r\n    if (this.box2dWorld) {\r\n      console.log('销毁旧的 Box2D 世界');\r\n      this.box2dWorld = null; // 让 GC 处理\r\n    }\r\n    \r\n    console.log('恢复物体到原始状态...');\r\n    // 恢复所有物体的原始状态\r\n    let restoredCount = 0;\r\n    for (const savedState of this.previewOriginalState) {\r\n      const body = this.objects.find(o => o.id === savedState.id) as Body;\r\n      if (body) {\r\n        body.position.x = savedState.position.x;\r\n        body.position.y = savedState.position.y;\r\n        body.angle = savedState.angle;\r\n        restoredCount++;\r\n      }\r\n    }\r\n    console.log(`已恢复 ${restoredCount} 个物体的状态`);\r\n    \r\n    // 重新初始化世界（会清空并重建 box2dBodies 和 box2dJoints）\r\n    this.initBox2DWorld();\r\n    this.previewPaused = false;\r\n    \r\n    // 重置按钮状态为播放中\r\n    document.getElementById('btn-preview-play')!.style.display = 'none';\r\n    document.getElementById('btn-preview-pause')!.style.display = 'inline-block';\r\n    \r\n    // 重新启动动画循环\r\n    this.startPreviewAnimation();\r\n    \r\n    console.log('=== 重置完成 ===');\r\n    this.updateStatus('物理预览已重置');\r\n  }\r\n\r\n  private exitPreview(): void {\r\n    console.log('退出物理预览');\r\n    \r\n    this.isPreviewMode = false;\r\n    \r\n    // 停止动画\r\n    if (this.previewAnimationId) {\r\n      cancelAnimationFrame(this.previewAnimationId);\r\n      this.previewAnimationId = null;\r\n    }\r\n    \r\n    // 销毁 Box2D 世界\r\n    if (this.box2dWorld) {\r\n      this.box2dWorld = null;\r\n    }\r\n    \r\n    this.box2dBodies.clear();\r\n    this.box2dJoints.clear();\r\n    \r\n    // 恢复所有物体的原始状态\r\n    for (const savedState of this.previewOriginalState) {\r\n      const body = this.objects.find(o => o.id === savedState.id) as Body;\r\n      if (body) {\r\n        body.position.x = savedState.position.x;\r\n        body.position.y = savedState.position.y;\r\n        body.angle = savedState.angle;\r\n      }\r\n    }\r\n    \r\n    // 清空保存的状态\r\n    this.previewOriginalState = [];\r\n    \r\n    // 恢复UI\r\n    document.getElementById('preview-controls')!.style.display = 'none';\r\n    document.getElementById('property-panel')!.style.display = 'flex';\r\n    this.canvas.style.cursor = 'crosshair';\r\n    \r\n    // 重新启用所有工具栏按钮和文件操作按钮\r\n    this.disableToolbar(false);\r\n    \r\n    // 重置按钮状态（为下次预览做准备）\r\n    document.getElementById('btn-preview-play')!.style.display = 'none';\r\n    document.getElementById('btn-preview-pause')!.style.display = 'none';\r\n    \r\n    // 重新渲染（使用原始状态）\r\n    this.render();\r\n    \r\n    this.updateStatus('已退出预览模式');\r\n  }\r\n}\r\n\r\n// ==================== 初始化 ====================\r\n\r\nwindow.addEventListener('DOMContentLoaded', () => {\r\n  new MapDesigner('design-canvas');\r\n});\r\n"],"names":["AddObjectCommand","objects","object","onUpdate","index","DeleteObjectCommand","__publicField","MoveObjectCommand","body","oldX","oldY","newX","newY","ModifyPropertyCommand","property","oldValue","newValue","CommandHistory","command","PPM","ORIGIN_OFFSET_X","ORIGIN_OFFSET_Y","GRID_SIZE","SELECTION_COLOR","BODY_COLORS","generateId","prefix","box2DToCanvas","box2dX","box2dY","canvasWidth","canvasHeight","offsetX","offsetY","canvasToBox2D","canvasX","canvasY","box2DToCanvasScale","box2dValue","distance","x1","y1","x2","y2","dx","dy","worldToLocal","worldX","worldY","bodyX","bodyY","bodyAngle","cos","sin","localToWorld","localX","localY","pointInRotatedRect","px","py","rectX","rectY","width","height","angle","local","halfW","halfH","pointInCircle","cx","cy","radius","pointInPolygon","vertices","centerX","centerY","inside","i","j","xi","yi","xj","yj","downloadFile","content","filename","blob","url","link","MapDesigner","canvasId","ppmSlider","ppmValue","originXSlider","originXValue","originYSlider","originYValue","btn","e","tool","file","canvasWidthSlider","canvasWidthValue","canvasHeightSlider","canvasHeightValue","resetBtn","value","panel","isCollapsed","rect","scaleX","scaleY","pos","deltaX","deltaY","vertexCount","maxVertices","hint","joint","isAnchorA","o","localPos","_e","anchor","prop","cmd","oldVertices","newVertices","worldPos","obj","mouseX","mouseY","worldPosBefore","delta","oldPPM","worldPosAfter","clampedX","clampedY","vertexIndex","vertex","anchorHit","firstVertex","bodyB","newObject","sum","v","localVertices","area","shapeType","x","y","bodyA","anchorA","anchorB","anchorALocal","anchorBLocal","hitRadius","anchorAWorld","anchorBWorld","worldVx","worldVy","objToDelete","ctx","worldMinX","worldMaxX","worldMinY","worldMaxY","canvasPos","origin","firstCanvas","lastVertex","lastCanvas","mouseCanvas","text","bodyCenter","w","h","r","isSelected","vCanvas","canvasVertex","anchorACanvas","anchorBCanvas","anchorRadius","isDraggingAnchorA","isDraggingAnchorB","midX","midY","shapePropertiesHTML","updateProp","id","isCheckbox","elem","posXInput","posYInput","angleInput","oldAngle","newAngle","_","xInput","yInput","isDegree","updateAnchor","isX","undoBtn","redoBtn","messages","statusTool","statusObjects","statusCoords","statusMessage","data","error","box2dData","json","fixtures","disabled","k","b2AABB","b2World","b2Vec2","worldAABB","gravityValue","gravity","doSleep","bodies","joints","bodySuccessCount","bodyFailCount","b2Body","jointSuccessCount","jointFailCount","b2Joint","b2BodyDef","b2BoxDef","b2CircleDef","b2PolyDef","bodyDef","shapeDef","halfWidth","halfHeight","vx","vy","shapeList","b2RevoluteJointDef","bodyAObj","bodyBObj","jointDef","anchorCanvasX","anchorCanvasY","animate","wasPaused","currentStates","state","restoredCount","savedState"],"mappings":"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"}